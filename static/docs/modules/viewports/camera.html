<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>viewports.camera &mdash; MCEdit-Unified v1.5.6.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../static/css/bootstrap3/bootswatch-yeti.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" href="../../static/css/adjust_theme/bootswatch-yeti.css" type="text/css" />

<link rel="stylesheet" href="../../static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     'v1.5.6.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../static/underscore.js"></script>
    <script type="text/javascript" src="../../static/doctools.js"></script>
    <script type="text/javascript" src="../../static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../../static/favicon.ico"/>
    <link rel="top" title="MCEdit-Unified v1.5.6.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">MCEdit-Unified v1.5.6.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../index.html" accesskey="U">Module code</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../static/favicon.png" alt="Logo"/>
    </a></p>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for viewports.camera</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf_8 -*-</span>
<span class="c"># The above line is necessary, unless we want problems with encodings...</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">compass</span> <span class="kn">import</span> <span class="n">CompassOverlay</span>
<span class="kn">from</span> <span class="nn">raycaster</span> <span class="kn">import</span> <span class="n">TooFarException</span>
<span class="kn">import</span> <span class="nn">raycaster</span>
<span class="kn">import</span> <span class="nn">keys</span>
<span class="kn">import</span> <span class="nn">pygame</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">config</span>
<span class="kn">import</span> <span class="nn">frustum</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">glutils</span>
<span class="kn">import</span> <span class="nn">mceutils</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pymclevel</span>
<span class="kn">from</span> <span class="nn">pymclevel</span> <span class="kn">import</span> <span class="n">MCEDIT_DEFS</span><span class="p">,</span> <span class="n">MCEDIT_IDS</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isnan</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">OpenGL</span> <span class="kn">import</span> <span class="n">GL</span>
<span class="kn">from</span> <span class="nn">OpenGL</span> <span class="kn">import</span> <span class="n">GLU</span>

<span class="kn">from</span> <span class="nn">albow</span> <span class="kn">import</span> <span class="n">alert</span><span class="p">,</span> <span class="n">AttrRef</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">input_text</span><span class="p">,</span> <span class="n">Row</span><span class="p">,</span> <span class="n">TableColumn</span><span class="p">,</span> <span class="n">TableView</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="n">CheckBox</span><span class="p">,</span> \
    <span class="n">TextFieldWrapped</span><span class="p">,</span> <span class="n">MenuButton</span><span class="p">,</span> <span class="n">ChoiceButton</span><span class="p">,</span> <span class="n">IntInputRow</span><span class="p">,</span> <span class="n">TextInputRow</span><span class="p">,</span> <span class="n">showProgress</span><span class="p">,</span> <span class="n">IntField</span><span class="p">,</span> <span class="n">ask</span>
<span class="kn">from</span> <span class="nn">albow.controls</span> <span class="kn">import</span> <span class="n">Label</span><span class="p">,</span> <span class="n">ValueDisplay</span>
<span class="kn">from</span> <span class="nn">albow.dialogs</span> <span class="kn">import</span> <span class="n">Dialog</span><span class="p">,</span> <span class="n">wrapped_label</span>
<span class="kn">from</span> <span class="nn">albow.openglwidgets</span> <span class="kn">import</span> <span class="n">GLViewport</span>
<span class="kn">from</span> <span class="nn">albow.extended_widgets</span> <span class="kn">import</span> <span class="n">BasicTextInputRow</span><span class="p">,</span> <span class="n">CheckBoxLabel</span>
<span class="kn">from</span> <span class="nn">albow.translate</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">albow.root</span> <span class="kn">import</span> <span class="n">get_top_widget</span>
<span class="kn">from</span> <span class="nn">pygame</span> <span class="kn">import</span> <span class="n">mouse</span>
<span class="kn">from</span> <span class="nn">depths</span> <span class="kn">import</span> <span class="n">DepthOffset</span>
<span class="kn">from</span> <span class="nn">editortools.operation</span> <span class="kn">import</span> <span class="n">Operation</span>
<span class="kn">from</span> <span class="nn">glutils</span> <span class="kn">import</span> <span class="n">gl</span>
<span class="kn">from</span> <span class="nn">pymclevel.nbt</span> <span class="kn">import</span> <span class="n">TAG_String</span>
<span class="kn">from</span> <span class="nn">editortools.nbtexplorer</span> <span class="kn">import</span> <span class="n">SlotEditor</span>

<div class="viewcode-block" id="SignEditOperation"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SignEditOperation">[docs]</a><span class="k">class</span> <span class="nc">SignEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">,</span> <span class="n">backupTileEntity</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tileEntity</span> <span class="o">=</span> <span class="n">tileEntity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">backupTileEntity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="SignEditOperation.perform"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SignEditOperation.perform">[docs]</a>        <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tileEntity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="SignEditOperation.undo"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SignEditOperation.undo">[docs]</a>        <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tileEntity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SignEditOperation.redo"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SignEditOperation.redo">[docs]</a>        <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="CameraViewport"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport">[docs]</a><span class="k">class</span> <span class="nc">CameraViewport</span><span class="p">(</span><span class="n">GLViewport</span><span class="p">):</span>
    <span class="n">anchor</span> <span class="o">=</span> <span class="s">&quot;tlbr&quot;</span>

    <span class="n">oldMousePosition</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">dontShowMessageAgain</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">,</span> <span class="n">def_enc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">editor</span>
        <span class="k">global</span> <span class="n">DEF_ENC</span>
        <span class="n">DEF_ENC</span> <span class="o">=</span> <span class="n">def_enc</span> <span class="ow">or</span> <span class="n">editor</span><span class="o">.</span><span class="n">mcedit</span><span class="o">.</span><span class="n">def_enc</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">mcedit</span><span class="o">.</span><span class="n">rect</span>
        <span class="n">GLViewport</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>

        <span class="c"># Declare a pseudo showCommands function, since it is called by other objects before its creation in mouse_move.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showCommands</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span><span class="bp">None</span>

        <span class="n">near</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">far</span> <span class="o">=</span> <span class="mf">4000.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">near</span> <span class="o">=</span> <span class="n">near</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">far</span> <span class="o">=</span> <span class="n">far</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">brake</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastTick</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="c"># self.nearheight = near * tang</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span> <span class="o">=</span> <span class="p">(</span><span class="mf">16.</span><span class="p">,</span> <span class="mf">45.</span><span class="p">,</span> <span class="mf">16.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="o">-</span><span class="mf">45.</span>  <span class="c"># degrees</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pitch</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cameraVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cameraVector</span><span class="p">()</span>

        <span class="c"># A state machine to dodge an apparent bug in pygame that generates erroneous mouse move events</span>
        <span class="c"># 0 = bad event already happened</span>
        <span class="c"># 1 = app just started or regained focus since last bad event</span>
        <span class="c">#   2 = mouse cursor was hidden after state 1, next event will be bad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">drawSky</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">drawFog</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">superSecretSettings</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">showCeiling</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">cameraAccel</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;accelFactor&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">cameraMaxSpeed</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;maxSpeed&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">cameraBrakingSpeed</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;brakeMaxSpeed&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">invertMousePitch</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">autobrake</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">swapAxes</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">compassToggle</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fov</span><span class="o">.</span><span class="n">addObserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;fovSetting&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updateFov</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouseVector</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_root</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hoveringCommandBlock</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_info_parsers</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># self.add(DebugDisplay(self, &quot;cameraPosition&quot;, &quot;blockFaceUnderCursor&quot;, &quot;mouseVector&quot;, &quot;mouse3dPoint&quot;))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pitch</span>

    <span class="nd">@pitch.setter</span>
    <span class="k">def</span> <span class="nf">pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pitch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">89.999</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">89.999</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

<div class="viewcode-block" id="CameraViewport.updateFov"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.updateFov">[docs]</a>    <span class="k">def</span> <span class="nf">updateFov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">hfov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovSetting</span>
        <span class="n">fov</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">hfov</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">fov</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="CameraViewport.stopMoving"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.stopMoving">[docs]</a>    <span class="k">def</span> <span class="nf">stopMoving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="CameraViewport.brakeOn"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.brakeOn">[docs]</a>    <span class="k">def</span> <span class="nf">brakeOn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brake</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="CameraViewport.brakeOff"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.brakeOff">[docs]</a>    <span class="k">def</span> <span class="nf">brakeOff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brake</span> <span class="o">=</span> <span class="bp">False</span>
</div>
    <span class="n">tickInterval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">targetFPS</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="n">oldPosition</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">flyMode</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">flyMode</span><span class="o">.</span><span class="n">property</span><span class="p">()</span>

<div class="viewcode-block" id="CameraViewport.tickCamera"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.tickCamera">[docs]</a>    <span class="k">def</span> <span class="nf">tickCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameStartTime</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">inSpace</span><span class="p">):</span>
        <span class="n">timePassed</span> <span class="o">=</span> <span class="p">(</span><span class="n">frameStartTime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastTick</span><span class="p">)</span><span class="o">.</span><span class="n">microseconds</span>
        <span class="k">if</span> <span class="n">timePassed</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickInterval</span> <span class="o">*</span> <span class="mi">1000</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_focused</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastTick</span> <span class="o">=</span> <span class="n">frameStartTime</span>
        <span class="n">timeDelta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">timePassed</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000000.</span>
        <span class="n">timeDelta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">timeDelta</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">)</span>  <span class="c"># 8fps lower limit!</span>
        <span class="n">drag</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">cameraDrag</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">accel_factor</span> <span class="o">=</span> <span class="n">drag</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">cameraAccel</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c"># if we&#39;re in space, move faster</span>

        <span class="n">drag_epsilon</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">timeDelta</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">brake</span><span class="p">:</span>
            <span class="n">max_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brakeMaxSpeed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxSpeed</span>

        <span class="k">if</span> <span class="n">inSpace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">sprint</span><span class="p">:</span>
            <span class="n">accel_factor</span> <span class="o">*=</span> <span class="mf">3.0</span>
            <span class="n">max_speed</span> <span class="o">*=</span> <span class="mf">3.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">sprint</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">viewMode</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Chunk&quot;</span><span class="p">:</span>
            <span class="n">accel_factor</span> <span class="o">*=</span> <span class="mf">2.0</span>
            <span class="n">max_speed</span> <span class="o">*=</span> <span class="mf">2.0</span>

        <span class="n">pi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cameraPanKeys</span>
        <span class="n">mouseSpeed</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">mouseSpeed</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">+=</span> <span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mouseSpeed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">+=</span> <span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">mouseSpeed</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">viewMode</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Chunk&quot;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">flyMode</span><span class="p">:</span>
            <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anglesToVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapAxes</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anglesToVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cameraVector</span><span class="p">()</span>

        <span class="n">velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span>  <span class="c"># xxx learn to use matrix/vector libs</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="n">yaw</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">)</span>
        <span class="n">cosyaw</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span>
        <span class="n">sinyaw</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span>

        <span class="n">directedInputs</span> <span class="o">=</span> <span class="n">mceutils</span><span class="o">.</span><span class="n">normalize</span><span class="p">((</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cosyaw</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dz</span> <span class="o">-</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sinyaw</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="c"># give the camera an impulse according to the state of the inputs and in the direction of the camera</span>
        <span class="n">cameraAccel</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">accel_factor</span> <span class="o">*</span> <span class="n">timeDelta</span><span class="p">,</span> <span class="n">directedInputs</span><span class="p">)</span>
        <span class="c"># cameraImpulse = map(lambda x: x*impulse_factor, directedInputs)</span>

        <span class="n">newVelocity</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">cameraAccel</span><span class="p">)</span>
        <span class="n">velocityDir</span><span class="p">,</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">mceutils</span><span class="o">.</span><span class="n">normalize_size</span><span class="p">(</span><span class="n">newVelocity</span><span class="p">)</span>

        <span class="c"># apply drag</span>
        <span class="k">if</span> <span class="n">speed</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autobrake</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
                <span class="n">speed</span> <span class="o">*=</span> <span class="mf">0.15</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="n">sign</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span>
                <span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span> <span class="o">-</span> <span class="p">(</span><span class="n">drag</span> <span class="o">*</span> <span class="n">timeDelta</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">speed</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">speed</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">speed</span> <span class="o">*=</span> <span class="n">sign</span>

        <span class="n">speed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">max_speed</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_speed</span><span class="p">,</span> <span class="n">speed</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">speed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">drag_epsilon</span><span class="p">:</span>
            <span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">velocity</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">speed</span><span class="p">,</span> <span class="n">velocityDir</span><span class="p">)</span>

        <span class="c"># velocity = map(lambda p,d: p + d, velocity, cameraImpulse)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldPosition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">32.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oldPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateFloorQuad</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">p</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">timeDelta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">,</span> <span class="n">velocity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">3800.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3800.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1000.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1000.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cameraVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cameraVector</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span><span class="o">.</span><span class="n">previewRenderer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span><span class="o">.</span><span class="n">previewRenderer</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span>
</div>
<div class="viewcode-block" id="CameraViewport.setModelview"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.setModelview">[docs]</a>    <span class="k">def</span> <span class="nf">setModelview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span>
        <span class="n">look</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">)</span>
        <span class="n">look</span> <span class="o">=</span> <span class="n">look</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraVector</span>
        <span class="n">up</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">GLU</span><span class="o">.</span><span class="n">gluLookAt</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                      <span class="n">look</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">look</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">look</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                      <span class="n">up</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">up</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">up</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</div>
    <span class="k">def</span> <span class="nf">_cameraVector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anglesToVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_anglesToVector</span><span class="p">(</span><span class="n">yaw</span><span class="p">,</span> <span class="n">pitch</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">nanzero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yaw</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">yaw</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">pitch</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">nanzero</span><span class="p">,</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">])</span>

<div class="viewcode-block" id="CameraViewport.updateMouseVector"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.updateMouseVector">[docs]</a>    <span class="k">def</span> <span class="nf">updateMouseVector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseVector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouseVector</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_mouseVector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns a vector reflecting a ray cast from the camera</span>
<span class="sd">        position to the mouse position on the near plane</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="c"># if (x, y) not in self.rect:</span>
        <span class="c"># return (0, 0, 0);  # xxx</span>

        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">point1</span> <span class="o">=</span> <span class="n">unproject</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">point2</span> <span class="o">=</span> <span class="n">unproject</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span> <span class="o">-</span> <span class="n">point1</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">mceutils</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">_blockUnderCursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns a point in 3d space that was determined by</span>
<span class="sd">         reading the depth buffer value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glReadBuffer</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BACK</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;Exception during glReadBuffer&#39;</span><span class="p">)</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ws</span>
            <span class="n">x</span> <span class="o">//=</span> <span class="mi">2</span>
            <span class="n">y</span> <span class="o">//=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">ws</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pixel</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glReadPixels</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_COMPONENT</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">)</span>
            <span class="n">newpoint</span> <span class="o">=</span> <span class="n">unproject</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">newpoint</span>

<div class="viewcode-block" id="CameraViewport.updateBlockFaceUnderCursor"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.updateBlockFaceUnderCursor">[docs]</a>    <span class="k">def</span> <span class="nf">updateBlockFaceUnderCursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">focusPair</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableMouseLag</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">frames</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateMouseVector</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">mouseEntered</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseMovesCamera</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">focusPair</span> <span class="o">=</span> <span class="n">raycaster</span><span class="o">.</span><span class="n">firstBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouseVector</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">,</span>
                                                         <span class="mi">100</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">viewMode</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
                    <span class="k">except</span> <span class="n">TooFarException</span><span class="p">:</span>
                        <span class="n">mouse3dPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blockUnderCursor</span><span class="p">()</span>
                        <span class="n">focusPair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findBlockFaceUnderCursor</span><span class="p">(</span><span class="n">mouse3dPoint</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">longDistanceMode</span><span class="p">:</span>
                    <span class="n">mouse3dPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blockUnderCursor</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">focusPair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findBlockFaceUnderCursor</span><span class="p">(</span><span class="n">mouse3dPoint</span><span class="p">)</span>

            <span class="c"># otherwise, find the block at a controllable distance in front of the camera</span>
            <span class="k">if</span> <span class="n">focusPair</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseMovesCamera</span><span class="p">:</span>
                    <span class="n">focusPair</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCameraPoint</span><span class="p">(),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">focusPair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">focusPair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">focusPair</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">focusPair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">backupTE</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">te</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">te</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&quot;Sign&quot;</span> <span class="ow">or</span> <span class="n">MCEDIT_IDS</span><span class="o">.</span><span class="n">GET</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;DEF_BLOCKS_STANDING_SIGN&quot;</span><span class="p">,</span> <span class="s">&quot;DEFS_BLOCKS_WALL_SIGN&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="s">&quot;Text1&quot;</span> <span class="ow">in</span> <span class="n">te</span> <span class="ow">and</span> <span class="s">&quot;Text2&quot;</span> <span class="ow">in</span> <span class="n">te</span> <span class="ow">and</span> <span class="s">&quot;Text3&quot;</span> <span class="ow">in</span> <span class="n">te</span> <span class="ow">and</span> <span class="s">&quot;Text4&quot;</span> <span class="ow">in</span> <span class="n">te</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s">&quot;Text&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">:</span>
                                    <span class="n">te</span><span class="p">[</span><span class="s">&quot;Text&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s">&quot;Text&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span><span class="p">)[:</span><span class="mi">32767</span><span class="p">])</span>
                                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dontShowMessageAgain</span><span class="p">:</span>
                            <span class="n">response</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="s">&quot;Found a sign that exceeded the maximum character limit. Automatically trimmed the sign to prevent crashes.&quot;</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Ok&quot;</span><span class="p">,</span> <span class="s">&quot;Don&#39;t show this again&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">response</span> <span class="o">==</span> <span class="s">&quot;Don&#39;t show this again&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dontShowMessageAgain</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">op</span> <span class="o">=</span> <span class="n">SignEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">backupTE</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span> <span class="o">=</span> <span class="n">focusPair</span>
</div>
    <span class="k">def</span> <span class="nf">_findBlockFaceUnderCursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projectedPoint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a (pos, Face) pair or None if one couldn&#39;t be found&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">intProjectedPoint</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">,</span> <span class="n">projectedPoint</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>  <span class="c"># catch NaNs</span>
        <span class="n">intProjectedPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">intProjectedPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># find out which face is under the cursor.  xxx do it more precisely</span>
        <span class="n">faceVector</span> <span class="o">=</span> <span class="p">((</span><span class="n">projectedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">intProjectedPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)),</span>
                      <span class="p">(</span><span class="n">projectedPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">intProjectedPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)),</span>
                      <span class="p">(</span><span class="n">projectedPoint</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">intProjectedPoint</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">av</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">faceVector</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">av</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">av</span><span class="p">))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">faceVector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">potentialOffsets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">blockAt</span><span class="p">(</span><span class="o">*</span><span class="n">intProjectedPoint</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">ChunkNotPresent</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">intProjectedPoint</span><span class="p">,</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">block</span> <span class="o">==</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">SnowLayer</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span>
            <span class="n">potentialOffsets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># discard any faces that aren&#39;t likely to be exposed</span>
            <span class="k">for</span> <span class="n">face</span><span class="p">,</span> <span class="n">offsets</span> <span class="ow">in</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">faceDirections</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">intProjectedPoint</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">neighborBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">blockAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">block</span> <span class="o">!=</span> <span class="n">neighborBlock</span><span class="p">:</span>
                        <span class="n">potentialOffsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">ChunkNotPresent</span><span class="p">):</span>
                    <span class="k">pass</span>

        <span class="c"># check each component of the face vector to see if that face is exposed</span>
        <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">potentialOffsets</span><span class="p">:</span>
            <span class="n">av</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">av</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">av</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">faceVector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">potentialOffsets</span><span class="p">:</span>
                <span class="n">av</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">av</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">av</span><span class="p">))</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">faceVector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">potentialOffsets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">potentialOffsets</span><span class="p">):</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">potentialOffsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># use the top face as a fallback</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">intProjectedPoint</span><span class="p">,</span> <span class="n">d</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="n">startingMousePosition</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CameraViewport.mouseLookOn"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouseLookOn">[docs]</a>    <span class="k">def</span> <span class="nf">mouseLookOn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">capture_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_switch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startingMousePosition</span> <span class="o">=</span> <span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">=</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="CameraViewport.mouseLookOff"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouseLookOff">[docs]</a>    <span class="k">def</span> <span class="nf">mouseLookOff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">capture_mouse</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startingMousePosition</span><span class="p">:</span>
            <span class="n">mouse</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">startingMousePosition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startingMousePosition</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mouseMovesCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">captured_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

<div class="viewcode-block" id="CameraViewport.toggleMouseLook"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.toggleMouseLook">[docs]</a>    <span class="k">def</span> <span class="nf">toggleMouseLook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseMovesCamera</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseLookOn</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseLookOff</span><span class="p">()</span>

    <span class="c"># mobs is overrided in __init__</span></div>
    <span class="n">mobs</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">Entity</span><span class="o">.</span><span class="n">monsters</span> <span class="o">+</span> <span class="p">[</span><span class="s">&quot;[Custom]&quot;</span><span class="p">]</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editMonsterSpawner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">mobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mobs</span>
        <span class="n">_mobs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Get the mobs from the versionned data</span>
        <span class="kn">from</span> <span class="nn">pymclevel</span> <span class="kn">import</span> <span class="n">MCEDIT_DEFS</span><span class="p">,</span> <span class="n">MCEDIT_IDS</span>
        <span class="k">if</span> <span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;spawner_monsters&#39;</span><span class="p">):</span>
            <span class="n">mobs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">MCEDIT_DEFS</span><span class="p">[</span><span class="s">&#39;spawner_monsters&#39;</span><span class="p">]:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">MCEDIT_IDS</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="p">[</span><span class="n">_id</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
                <span class="n">_mobs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">_mobs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">mobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;MobSpawner&quot;</span><span class="p">,</span> <span class="s">&quot;MobSpawner&quot;</span><span class="p">))</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Delay&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Short</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;EntityId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mobs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">addMob</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mobs</span><span class="p">:</span>
                <span class="n">mobs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
                <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">selectTableRow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;[Custom]&quot;</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">input_text</span><span class="p">(</span><span class="s">&quot;Type in an EntityID for this spawner. Invalid IDs may crash Minecraft.&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="n">addMob</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">mobs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">num_clicks</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">mobTable</span> <span class="o">=</span> <span class="n">TableView</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mobTable</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mobs</span><span class="p">)</span>
        <span class="n">mobTable</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">mobs</span><span class="p">[</span><span class="n">i</span><span class="p">],)</span>
        <span class="n">mobTable</span><span class="o">.</span><span class="n">row_is_selected</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span>
        <span class="n">mobTable</span><span class="o">.</span><span class="n">click_row</span> <span class="o">=</span> <span class="n">selectTableRow</span>
        <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">selectedMob</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">mobs</span><span class="p">[</span><span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_mobs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cancel</span><span class="p">():</span>
            <span class="n">mobs</span><span class="p">[</span><span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&quot;EntityId&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;EntityId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="c">#             id = MCEDIT_DEFS.get(MCEDIT_IDS.get(_id, _id), {}).get(&quot;name&quot;, _id)</span>
        <span class="k">elif</span> <span class="s">&quot;SpawnData&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnData&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="s">&quot;[Custom]&quot;</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">MCEDIT_IDS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_id</span><span class="p">,</span> <span class="n">_id</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">_id</span><span class="p">)</span>

        <span class="n">addMob</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="n">mobTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">mobs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">oldChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Current: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">_mobs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="nb">id</span><span class="p">),</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span> <span class="p">))</span>
        <span class="n">newChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">ValueDisplay</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">get_value</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Change to: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">selectedMob</span><span class="p">()),</span> <span class="n">mobTable</span><span class="p">))</span>

        <span class="n">lastRow</span> <span class="o">=</span> <span class="n">Row</span><span class="p">((</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">),</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">cancel</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">((</span><span class="n">oldChoiceCol</span><span class="p">,</span> <span class="n">newChoiceCol</span><span class="p">,</span> <span class="n">lastRow</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">MonsterSpawnerEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">selectedMob</span><span class="p">():</span>
            <span class="k">if</span> <span class="s">&quot;EntityId&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;EntityId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">selectedMob</span><span class="p">())</span>
            <span class="k">if</span> <span class="s">&quot;SpawnData&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
                <span class="c"># Try to not clear the spawn data, but only update the mob id</span>
<span class="c">#                 tileEntity[&quot;SpawnData&quot;] = pymclevel.TAG_Compound()</span>
                <span class="n">tag_id</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">selectedMob</span><span class="p">())</span>
                <span class="k">if</span> <span class="s">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnData&quot;</span><span class="p">]:</span>
                    <span class="n">tag_id</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span>
                    <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnData&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_id</span>
                <span class="k">if</span> <span class="s">&quot;EntityId&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnData&quot;</span><span class="p">]:</span>
                    <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnData&quot;</span><span class="p">][</span><span class="s">&quot;EntityId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag_id</span>
            <span class="k">if</span> <span class="s">&quot;SpawnPotentials&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">potential</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SpawnPotentials&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s">&quot;Entity&quot;</span> <span class="ow">in</span> <span class="n">potential</span><span class="p">:</span>
                        <span class="c"># MC 1.9+</span>
                        <span class="k">if</span> <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Entity&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="nb">id</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&quot;EntityId&quot;</span> <span class="ow">in</span> <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Entity&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Entity&quot;</span><span class="p">][</span><span class="s">&quot;EntityId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="nb">id</span><span class="p">):</span>
                            <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
                            <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Entity&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">selectedMob</span><span class="p">())</span>
                    <span class="k">elif</span> <span class="s">&quot;Properties&quot;</span> <span class="ow">in</span> <span class="n">potential</span><span class="p">:</span>
                        <span class="c"># MC before 1.9</span>
                        <span class="k">if</span> <span class="s">&quot;Type&quot;</span> <span class="ow">in</span> <span class="n">potential</span> <span class="ow">and</span> <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                            <span class="n">potential</span><span class="p">[</span><span class="s">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">selectedMob</span><span class="p">())</span>
                        <span class="c"># We also can change some other values in the Properties tag, but it is useless in MC 1.8+.</span>
                        <span class="c"># The fact is this data will not be updated by the game after the mob type is changed, but the old mob will not spawn.</span>
<span class="c">#                         put_entityid = False</span>
<span class="c">#                         put_id = False</span>
<span class="c">#                         if &quot;EntityId&quot; in potential[&quot;Properties&quot;] and potential[&quot;Properties&quot;][&quot;EntityId&quot;].value == id:</span>
<span class="c">#                             put_entityid = True</span>
<span class="c">#                         if &quot;id&quot; in potential[&quot;Properties&quot;] and potential[&quot;Properties&quot;][&quot;id&quot;].value == id:</span>
<span class="c">#                             put_id = True</span>
<span class="c">#                         new_props = pymclevel.TAG_Compound()</span>
<span class="c">#                         if put_entityid:</span>
<span class="c">#                             new_props[&quot;EntityId&quot;] = pymclevel.TAG_String(selectedMob())</span>
<span class="c">#                         if put_id:</span>
<span class="c">#                             new_props[&quot;id&quot;] = pymclevel.TAG_String(selectedMob())</span>
<span class="c">#                         potential[&quot;Properties&quot;] = new_props</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">MonsterSpawnerEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editJukebox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">discs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;[No Record]&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;13&quot;</span><span class="p">:</span> <span class="mi">2256</span><span class="p">,</span>
            <span class="s">&quot;cat&quot;</span><span class="p">:</span> <span class="mi">2257</span><span class="p">,</span>
            <span class="s">&quot;blocks&quot;</span><span class="p">:</span> <span class="mi">2258</span><span class="p">,</span>
            <span class="s">&quot;chirp&quot;</span><span class="p">:</span> <span class="mi">2259</span><span class="p">,</span>
            <span class="s">&quot;far&quot;</span><span class="p">:</span> <span class="mi">2260</span><span class="p">,</span>
            <span class="s">&quot;mall&quot;</span><span class="p">:</span> <span class="mi">2261</span><span class="p">,</span>
            <span class="s">&quot;mellohi&quot;</span><span class="p">:</span> <span class="mi">2262</span><span class="p">,</span>
            <span class="s">&quot;stal&quot;</span><span class="p">:</span> <span class="mi">2263</span><span class="p">,</span>
            <span class="s">&quot;strad&quot;</span><span class="p">:</span> <span class="mi">2264</span><span class="p">,</span>
            <span class="s">&quot;ward&quot;</span><span class="p">:</span> <span class="mi">2265</span><span class="p">,</span>
            <span class="s">&quot;11&quot;</span><span class="p">:</span> <span class="mi">2266</span><span class="p">,</span>
            <span class="s">&quot;wait&quot;</span><span class="p">:</span> <span class="mi">2267</span>
        <span class="p">}</span>

        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;RecordPlayer&quot;</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">selectTableRow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
            <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">num_clicks</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">discTable</span> <span class="o">=</span> <span class="n">TableView</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">discTable</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">discs</span><span class="p">)</span>
        <span class="n">discTable</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">selectedDisc</span><span class="p">(</span><span class="n">i</span><span class="p">),)</span>
        <span class="n">discTable</span><span class="o">.</span><span class="n">row_is_selected</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span>
        <span class="n">discTable</span><span class="o">.</span><span class="n">click_row</span> <span class="o">=</span> <span class="n">selectTableRow</span>
        <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">selectedDisc</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;[No Record]&quot;</span>
            <span class="k">return</span> <span class="n">discs</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">discs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">id</span> <span class="o">+</span> <span class="mi">2255</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">cancel</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;[No Record]&quot;</span><span class="p">:</span>
                <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">discs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2255</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&quot;RecordItem&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;RecordItem&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&quot;minecraft:air&quot;</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s">&quot;[No Record]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;RecordItem&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">17</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="s">&quot;Record&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="s">&quot;[No Record]&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">selectedDisc</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">2255</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="s">&quot;[No Record]&quot;</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;[No Record]&quot;</span><span class="p">:</span>
            <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">discs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2255</span>

        <span class="n">oldChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Current: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">id</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span> <span class="p">))</span>
        <span class="n">newChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">ValueDisplay</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">get_value</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Change to: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">selectedDisc</span><span class="p">(</span><span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">)),</span> <span class="n">discTable</span><span class="p">))</span>

        <span class="n">lastRow</span> <span class="o">=</span> <span class="n">Row</span><span class="p">((</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">),</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">cancel</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">((</span><span class="n">oldChoiceCol</span><span class="p">,</span> <span class="n">newChoiceCol</span><span class="p">,</span> <span class="n">lastRow</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">JukeboxEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">selectedDisc</span><span class="p">(</span><span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&quot;RecordItem&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;RecordItem&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Record&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">setBlockDataAt</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Record&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">discTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">+</span> <span class="mi">2255</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">setBlockDataAt</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">JukeboxEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editNoteBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;F# (0.5)&quot;</span><span class="p">,</span> <span class="s">&quot;G (0.53)&quot;</span><span class="p">,</span> <span class="s">&quot;G# (0.56)&quot;</span><span class="p">,</span>
            <span class="s">&quot;A (0.6)&quot;</span><span class="p">,</span> <span class="s">&quot;A# (0.63)&quot;</span><span class="p">,</span> <span class="s">&quot;B (0.67)&quot;</span><span class="p">,</span>
            <span class="s">&quot;C (0.7)&quot;</span><span class="p">,</span> <span class="s">&quot;C# (0.75)&quot;</span><span class="p">,</span> <span class="s">&quot;D (0.8)&quot;</span><span class="p">,</span>
            <span class="s">&quot;D# (0.85)&quot;</span><span class="p">,</span> <span class="s">&quot;E (0.9)&quot;</span><span class="p">,</span> <span class="s">&quot;F (0.95)&quot;</span><span class="p">,</span>
            <span class="s">&quot;F# (1.0)&quot;</span><span class="p">,</span> <span class="s">&quot;G (1.05)&quot;</span><span class="p">,</span> <span class="s">&quot;G# (1.1)&quot;</span><span class="p">,</span>
            <span class="s">&quot;A (1.2)&quot;</span><span class="p">,</span> <span class="s">&quot;A# (1.25)&quot;</span><span class="p">,</span> <span class="s">&quot;B (1.32)&quot;</span><span class="p">,</span>
            <span class="s">&quot;C (1.4)&quot;</span><span class="p">,</span> <span class="s">&quot;C# (1.5)&quot;</span><span class="p">,</span> <span class="s">&quot;D (1.6)&quot;</span><span class="p">,</span>
            <span class="s">&quot;D# (1.7)&quot;</span><span class="p">,</span> <span class="s">&quot;E (1.8)&quot;</span><span class="p">,</span> <span class="s">&quot;F (1.9)&quot;</span><span class="p">,</span>
            <span class="s">&quot;F# (2.0)&quot;</span>
        <span class="p">]</span>

        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;MobSpawner&quot;</span><span class="p">,</span> <span class="s">&quot;MobSpawner&quot;</span><span class="p">))</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;note&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">selectTableRow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
            <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">num_clicks</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">noteTable</span> <span class="o">=</span> <span class="n">TableView</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">(</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">noteTable</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
        <span class="n">noteTable</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">i</span><span class="p">],)</span>
        <span class="n">noteTable</span><span class="o">.</span><span class="n">row_is_selected</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span>
        <span class="n">noteTable</span><span class="o">.</span><span class="n">click_row</span> <span class="o">=</span> <span class="n">selectTableRow</span>
        <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">selectedNote</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">notes</span><span class="p">[</span><span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">cancel</span><span class="p">():</span>
            <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;note&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span> <span class="o">=</span> <span class="nb">id</span>

        <span class="n">oldChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Current: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">notes</span><span class="p">[</span><span class="nb">id</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span> <span class="p">))</span>
        <span class="n">newChoiceCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">ValueDisplay</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">get_value</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Change to: &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">selectedNote</span><span class="p">()),</span> <span class="n">noteTable</span><span class="p">))</span>

        <span class="n">lastRow</span> <span class="o">=</span> <span class="n">Row</span><span class="p">((</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">),</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">cancel</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">((</span><span class="n">oldChoiceCol</span><span class="p">,</span> <span class="n">newChoiceCol</span><span class="p">,</span> <span class="n">lastRow</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">NoteBlockEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">:</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;note&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="n">noteTable</span><span class="o">.</span><span class="n">selectedIndex</span><span class="p">)</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">NoteBlockEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editSign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>

        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">linekeys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Text&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>

        <span class="c"># From version 1.8, signs accept Json format.</span>
        <span class="c"># 1.9 does no more support the old raw string fomat.</span>
        <span class="n">splitVersion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">gameVersion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">newFmtVersion</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;9&#39;</span><span class="p">]</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">json_fmt</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="p">([</span><span class="s">&#39;0&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">b</span> <span class="o">+</span> <span class="p">([</span><span class="s">&#39;0&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="n">y</span><span class="p">),</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">splitVersion</span><span class="p">,</span> <span class="n">newFmtVersion</span><span class="p">))[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">json_fmt</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;{&quot;text&quot;:&quot;&quot;}&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
             <span class="c"># Don&#39;t know how to handle the difference between wall and standing signs for now...</span>
             <span class="c"># Just let this like it is until we can find the way!</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;Sign&quot;</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">linekeys</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>

        <span class="n">lineFields</span> <span class="o">=</span> <span class="p">[</span><span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">linekeys</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">linekeys</span><span class="p">,</span> <span class="n">lineFields</span><span class="p">):</span>

            <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

            <span class="c"># Double quotes handling for olf sign text format.</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;null&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="k">elif</span> <span class="n">json_fmt</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">fmt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&quot;&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">u&quot;§0  Black&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§1  Dark Blue&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§2  Dark Green&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§3  Dark Aqua&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§4  Dark Red&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§5  Dark Purple&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§6  Gold&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§7  Gray&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§8  Dark Gray&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§9  Blue&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§a  Green&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§b  Aqua&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§c  Red&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§d  Light Purple&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§e  Yellow&quot;</span><span class="p">,</span>
            <span class="s">u&quot;§f  White&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">menu_picked</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s">u&quot;§</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">index</span>
            <span class="n">currentField</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">focus_switch</span><span class="o">.</span><span class="n">focus_switch</span>
            <span class="n">currentField</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">c</span>  <span class="c"># xxx view hierarchy</span>
            <span class="n">currentField</span><span class="o">.</span><span class="n">insertion_point</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentField</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">changeSign</span><span class="p">():</span>
            <span class="n">unsavedChanges</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&quot;{}&quot;&#39;</span>
            <span class="n">u_fmt</span> <span class="o">=</span> <span class="s">u&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span>
            <span class="k">if</span> <span class="n">json_fmt</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;{}&#39;</span>
                <span class="n">u_fmt</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="si">%s</span><span class="s">&#39;</span>
            <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">linekeys</span><span class="p">,</span> <span class="n">lineFields</span><span class="p">):</span>
                <span class="n">oldText</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">u_fmt</span><span class="o">%</span><span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">[:</span><span class="mi">255</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">!=</span> <span class="n">oldText</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unsavedChanges</span><span class="p">:</span>
                    <span class="n">unsavedChanges</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">unsavedChanges</span><span class="p">:</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">SignEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">tileEntity</span><span class="p">,</span> <span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">colorMenu</span> <span class="o">=</span> <span class="n">MenuButton</span><span class="p">(</span><span class="s">&quot;Add Color Code...&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">menu_picked</span><span class="o">=</span><span class="n">menu_picked</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">((</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">changeSign</span><span class="p">),</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">)))</span>

        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Edit Sign&quot;</span><span class="p">)]</span> <span class="o">+</span> <span class="n">lineFields</span> <span class="o">+</span> <span class="p">[</span><span class="n">colorMenu</span><span class="p">,</span> <span class="n">row</span><span class="p">]</span>

        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editSkull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
        <span class="n">skullTypes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;Skeleton&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&quot;Wither Skeleton&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&quot;Zombie&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s">&quot;Player&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s">&quot;Creeper&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">inverseSkullType</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s">&quot;Skeleton&quot;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;Wither Skeleton&quot;</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="s">&quot;Zombie&quot;</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="s">&quot;Player&quot;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="s">&quot;Creeper&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="c"># Don&#39;t know how to handle the difference between skulls in this context signs for now...</span>
            <span class="c"># Tests nedded!</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;Skull&quot;</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SkullType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">titleLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s">&quot;Edit Skull Data&quot;</span><span class="p">)</span>
        <span class="n">usernameField</span> <span class="o">=</span> <span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>
        <span class="n">skullMenu</span> <span class="o">=</span> <span class="n">ChoiceButton</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">skullTypes</span><span class="p">))</span>

        <span class="k">if</span> <span class="s">&quot;Owner&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">usernameField</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Owner&quot;</span><span class="p">][</span><span class="s">&quot;Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&quot;ExtraType&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">usernameField</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;ExtraType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">usernameField</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="n">oldUserName</span> <span class="o">=</span> <span class="n">usernameField</span><span class="o">.</span><span class="n">value</span>
        <span class="n">skullMenu</span><span class="o">.</span><span class="n">selectedChoice</span> <span class="o">=</span> <span class="n">inverseSkullType</span><span class="p">[</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SkullType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="n">oldSelectedSkull</span> <span class="o">=</span> <span class="n">skullMenu</span><span class="o">.</span><span class="n">selectedChoice</span>

        <span class="k">class</span> <span class="nc">SkullEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">updateSkull</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">usernameField</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">oldUserName</span> <span class="ow">or</span> <span class="n">oldSelectedSkull</span> <span class="o">!=</span> <span class="n">skullMenu</span><span class="o">.</span><span class="n">selectedChoice</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;ExtraType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">usernameField</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SkullType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="n">skullTypes</span><span class="p">[</span><span class="n">skullMenu</span><span class="o">.</span><span class="n">selectedChoice</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&quot;Owner&quot;</span> <span class="ow">in</span> <span class="n">tileEntity</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Owner&quot;</span><span class="p">]</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">SkullEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">okBTN</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">updateSkull</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">)</span>

        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">titleLabel</span><span class="p">,</span> <span class="n">usernameField</span><span class="p">,</span> <span class="n">skullMenu</span><span class="p">,</span> <span class="n">okBTN</span><span class="p">,</span> <span class="n">cancel</span><span class="p">]</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editCommandBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>
        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Control&quot;</span><span class="p">,</span> <span class="s">&quot;Control&quot;</span><span class="p">))</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;TrackOutput&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SuccessCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">titleLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s">&quot;Edit Command Block&quot;</span><span class="p">)</span>
        <span class="n">commandField</span> <span class="o">=</span> <span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span>
        <span class="n">nameField</span> <span class="o">=</span> <span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">successField</span> <span class="o">=</span> <span class="n">IntInputRow</span><span class="p">(</span><span class="s">&quot;SuccessCount&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">trackOutput</span> <span class="o">=</span> <span class="n">CheckBox</span><span class="p">()</span>

        <span class="c"># Fix for the &#39;§ is Ä§&#39; issue</span>
<span class="c">#         try:</span>
<span class="c">#             commandField.value = tileEntity[&quot;Command&quot;].value.decode(&quot;unicode-escape&quot;)</span>
<span class="c">#         except:</span>
<span class="c">#             commandField.value = tileEntity[&quot;Command&quot;].value</span>
        <span class="n">commandField</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Command&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="n">oldCommand</span> <span class="o">=</span> <span class="n">commandField</span><span class="o">.</span><span class="n">value</span>
        <span class="n">trackOutput</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;TrackOutput&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">oldTrackOutput</span> <span class="o">=</span> <span class="n">trackOutput</span><span class="o">.</span><span class="n">value</span>
        <span class="n">nameField</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;CustomName&quot;</span><span class="p">,</span> <span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;@&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
        <span class="n">oldNameField</span> <span class="o">=</span> <span class="n">nameField</span><span class="o">.</span><span class="n">value</span>
        <span class="n">successField</span><span class="o">.</span><span class="n">subwidgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SuccessCount&quot;</span><span class="p">,</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
        <span class="n">oldSuccess</span> <span class="o">=</span> <span class="n">successField</span><span class="o">.</span><span class="n">subwidgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

        <span class="k">class</span> <span class="nc">CommandBlockEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">updateCommandBlock</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">oldCommand</span> <span class="o">!=</span> <span class="n">commandField</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="n">oldTrackOutput</span> <span class="o">!=</span> <span class="n">trackOutput</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="n">oldNameField</span> <span class="o">!=</span> <span class="n">nameField</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="n">oldSuccess</span> <span class="o">!=</span> <span class="n">successField</span><span class="o">.</span><span class="n">subwidgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">commandField</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;TrackOutput&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="n">trackOutput</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">nameField</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;SuccessCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">successField</span><span class="o">.</span><span class="n">subwidgets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="n">op</span> <span class="o">=</span> <span class="n">CommandBlockEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">okBTN</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">updateCommandBlock</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">)</span>
        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">titleLabel</span><span class="p">,</span> <span class="n">Label</span><span class="p">(</span><span class="s">&quot;Command:&quot;</span><span class="p">),</span> <span class="n">commandField</span><span class="p">,</span> <span class="n">Row</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Custom Name:&quot;</span><span class="p">),</span> <span class="n">nameField</span><span class="p">)),</span> <span class="n">successField</span><span class="p">,</span>
                  <span class="n">Row</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Track Output&quot;</span><span class="p">),</span> <span class="n">trackOutput</span><span class="p">)),</span> <span class="n">okBTN</span><span class="p">,</span> <span class="n">cancel</span><span class="p">]</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

        <span class="k">return</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editContainer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">containerID</span><span class="p">):</span>
        <span class="n">tileEntityTag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tileEntityTag</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tileEntityTag</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">containerID</span><span class="p">)</span>
            <span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">setpos</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">containerID</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">itemProp</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="c"># xxx do validation here</span>
            <span class="k">def</span> <span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]):</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedItemIndex</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

            <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]):</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedItemIndex</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>

            <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">ChestWidget</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
            <span class="n">dirty</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">Slot</span> <span class="o">=</span> <span class="n">itemProp</span><span class="p">(</span><span class="s">&quot;Slot&quot;</span><span class="p">)</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">itemProp</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
            <span class="n">Damage</span> <span class="o">=</span> <span class="n">itemProp</span><span class="p">(</span><span class="s">&quot;Damage&quot;</span><span class="p">)</span>
            <span class="n">Count</span> <span class="o">=</span> <span class="n">itemProp</span><span class="p">(</span><span class="s">&quot;Count&quot;</span><span class="p">)</span>
            <span class="n">itemLimit</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">maxItems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">containerID</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">slotFormat</span><span class="p">(</span><span class="n">slot</span><span class="p">):</span>
            <span class="n">slotNames</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">slotNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">containerID</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">slotNames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">slotNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span> <span class="n">slot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">slot</span>

        <span class="n">chestWidget</span> <span class="o">=</span> <span class="n">ChestWidget</span><span class="p">()</span>
        <span class="n">chestItemTable</span> <span class="o">=</span> <span class="n">TableView</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;Slot&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">slotFormat</span><span class="p">),</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;ID / ID Name&quot;</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">),</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;DMG&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">),</span>
            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;Count&quot;</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">),</span>

            <span class="n">TableColumn</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="k">def</span> <span class="nf">itemName</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">findItem</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="k">except</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">ItemNotFound</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Unknown Item&quot;</span>

        <span class="k">def</span> <span class="nf">getRowData</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">slot</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;Slot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;Count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">slot</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">itemName</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">)</span>

        <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">selectTableRow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="n">i</span>
            <span class="c"># Disabling the item selector for now, since we need PE items resources.</span>
<span class="c">#             if evt.num_clicks &gt; 1:</span>
<span class="c">#                 selectButtonAction()</span>

        <span class="k">def</span> <span class="nf">changeValue</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">s_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">Slot</span> <span class="o">=</span> <span class="n">s</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">Count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">Damage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>


        <span class="n">chestItemTable</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span>
        <span class="n">chestItemTable</span><span class="o">.</span><span class="n">row_data</span> <span class="o">=</span> <span class="n">getRowData</span>
        <span class="n">chestItemTable</span><span class="o">.</span><span class="n">row_is_selected</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span>
        <span class="n">chestItemTable</span><span class="o">.</span><span class="n">click_row</span> <span class="o">=</span> <span class="n">selectTableRow</span>
        <span class="n">chestItemTable</span><span class="o">.</span><span class="n">change_value</span> <span class="o">=</span> <span class="n">changeValue</span>

        <span class="k">def</span> <span class="nf">selectButtonAction</span><span class="p">():</span>
            <span class="n">SlotEditor</span><span class="p">(</span><span class="n">chestItemTable</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">chestWidget</span><span class="o">.</span><span class="n">Slot</span><span class="p">,</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">id</span> <span class="ow">or</span> <span class="s">u&quot;&quot;</span><span class="p">,</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">Count</span><span class="p">,</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">Damage</span><span class="p">)</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

        <span class="n">maxSlot</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">maxItems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">fieldRow</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">IntInputRow</span><span class="p">(</span><span class="s">&quot;Slot: &quot;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">AttrRef</span><span class="p">(</span><span class="n">chestWidget</span><span class="p">,</span> <span class="s">&#39;Slot&#39;</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">maxSlot</span><span class="p">),</span>
            <span class="n">BasicTextInputRow</span><span class="p">(</span><span class="s">&quot;ID / ID Name: &quot;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">AttrRef</span><span class="p">(</span><span class="n">chestWidget</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
            <span class="c"># Text to allow the input of internal item names</span>
            <span class="n">IntInputRow</span><span class="p">(</span><span class="s">&quot;DMG: &quot;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">AttrRef</span><span class="p">(</span><span class="n">chestWidget</span><span class="p">,</span> <span class="s">&#39;Damage&#39;</span><span class="p">),</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">32767</span><span class="p">),</span>
            <span class="n">IntInputRow</span><span class="p">(</span><span class="s">&quot;Count: &quot;</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">AttrRef</span><span class="p">(</span><span class="n">chestWidget</span><span class="p">,</span> <span class="s">&#39;Count&#39;</span><span class="p">),</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">64</span><span class="p">),</span>
            <span class="c"># This button is inactive for now, because we need to work with different IDs types:</span>
            <span class="c"># * The &#39;human&#39; IDs: Stone, Glass, Swords...</span>
            <span class="c"># * The MC ones: minecraft:stone, minecraft:air...</span>
            <span class="c"># * The PE ones: 0:0, 1:0...</span>
<span class="c">#             Button(&quot;Select&quot;, action=selectButtonAction)</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">deleteFromWorld</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">Damage</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

            <span class="n">deleteSameDamage</span> <span class="o">=</span> <span class="n">CheckBoxLabel</span><span class="p">(</span><span class="s">&quot;Only delete items with the same damage value&quot;</span><span class="p">)</span>
            <span class="n">deleteBlocksToo</span> <span class="o">=</span> <span class="n">CheckBoxLabel</span><span class="p">(</span><span class="s">&quot;Also delete blocks placed in the world&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>  <span class="c"># fluid blocks</span>
                <span class="n">deleteBlocksToo</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">wrapped_label</span><span class="p">(</span>
                <span class="s">&quot;WARNING: You are about to modify the entire world. This cannot be undone. Really delete all copies of this item from all land, chests, furnaces, dispensers, dropped items, item-containing tiles, and player inventories in this world?&quot;</span><span class="p">,</span>
                <span class="mi">60</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">deleteSameDamage</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">+=</span> <span class="p">(</span><span class="n">deleteBlocksToo</span><span class="p">,)</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="p">[</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">present</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;OK&quot;</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">deleteItemsIter</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">deleteSameDamage</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">t</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="nb">id</span> <span class="ow">and</span> <span class="n">t</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">Damage</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">def</span> <span class="nf">matches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">t</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="nb">id</span>

                    <span class="k">def</span> <span class="nf">matches_itementity</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="s">&quot;Item&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">False</span>
                        <span class="k">if</span> <span class="s">&quot;Item&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">False</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s">&quot;Item&quot;</span><span class="p">]</span>
                        <span class="k">return</span> <span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerTag</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
                        <span class="n">tag</span><span class="p">[</span><span class="s">&quot;Inventory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">[</span><span class="s">&quot;Inventory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>

                    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunks</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">id</span> <span class="o">&lt;</span> <span class="mi">256</span> <span class="ow">and</span> <span class="n">deleteBlocksToo</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                            <span class="n">matchingBlocks</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">Blocks</span> <span class="o">==</span> <span class="nb">id</span>
                            <span class="k">if</span> <span class="n">deleteSameDamage</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                                <span class="n">matchingBlocks</span> <span class="o">&amp;=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">Data</span> <span class="o">==</span> <span class="n">Damage</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">matchingBlocks</span><span class="p">):</span>
                                <span class="n">chunk</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">matchingBlocks</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">chunk</span><span class="o">.</span><span class="n">Data</span><span class="p">[</span><span class="n">matchingBlocks</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">chunk</span><span class="o">.</span><span class="n">chunkChanged</span><span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">invalidateChunks</span><span class="p">([</span><span class="n">chunk</span><span class="o">.</span><span class="n">chunkPosition</span><span class="p">])</span>

                        <span class="k">for</span> <span class="n">te</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">TileEntities</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s">&quot;Items&quot;</span> <span class="ow">in</span> <span class="n">te</span><span class="p">:</span>
                                <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span>

                                <span class="n">te</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">te</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
                                <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]):</span>
                                    <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">Entities</span> <span class="k">if</span> <span class="n">matches_itementity</span><span class="p">(</span><span class="n">e</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">Entities</span><span class="p">):</span>
                            <span class="n">chunk</span><span class="o">.</span><span class="n">Entities</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">entities</span>
                            <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>

                        <span class="k">yield</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">chunkCount</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">progressInfo</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Deleting the item {0} from the entire world ({1} chunks)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">itemName</span><span class="p">(</span><span class="n">chestWidget</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">chunkCount</span><span class="p">)</span>

                <span class="n">showProgress</span><span class="p">(</span><span class="n">progressInfo</span><span class="p">,</span> <span class="n">deleteItemsIter</span><span class="p">(),</span> <span class="n">cancel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>
                <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">deleteItem</span><span class="p">():</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">item</span><span class="p">]</span>
            <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">deleteEnable</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">selectedItemIndex</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">def</span> <span class="nf">addEnable</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">itemLimit</span>

        <span class="k">def</span> <span class="nf">addItem</span><span class="p">():</span>
            <span class="n">slot</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">slot</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s">&quot;Slot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="n">slot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">slot</span> <span class="o">&gt;=</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">itemLimit</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;minecraft:&quot;</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Short</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&quot;Slot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="n">slot</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="s">&quot;Count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Byte</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tileEntityTag</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="n">addItemButton</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;New Item (1.7+)&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">addItem</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">addEnable</span><span class="p">)</span>
        <span class="n">deleteItemButton</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Delete This Item&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">deleteItem</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">deleteEnable</span><span class="p">)</span>
        <span class="n">deleteFromWorldButton</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Delete All Instances Of This Item From World&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">deleteFromWorld</span><span class="p">,</span>
                                       <span class="n">enable</span><span class="o">=</span><span class="n">deleteEnable</span><span class="p">)</span>
        <span class="n">deleteCol</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">addItemButton</span><span class="p">,</span> <span class="n">deleteItemButton</span><span class="p">,</span> <span class="n">deleteFromWorldButton</span><span class="p">))</span>

        <span class="n">fieldRow</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="n">fieldRow</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">Column</span><span class="p">((</span><span class="n">chestItemTable</span><span class="p">,</span> <span class="n">fieldRow</span><span class="p">,</span> <span class="n">deleteCol</span><span class="p">))</span>

        <span class="n">chestWidget</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">chestWidget</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>

        <span class="n">Dialog</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">chestWidget</span><span class="p">,</span> <span class="n">responses</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Done&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span>

        <span class="k">class</span> <span class="nc">ChestEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">)</span>
                <span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntityTag</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">chestWidget</span><span class="o">.</span><span class="n">dirty</span><span class="p">:</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">ChestEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editFlowerPot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>
        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;FlowerPot&quot;</span><span class="p">,</span> <span class="s">&quot;FlowerPot&quot;</span><span class="p">))</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Item&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">titleLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s">&quot;Edit Flower Pot&quot;</span><span class="p">)</span>
        <span class="n">Item</span> <span class="o">=</span> <span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Item&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">oldItem</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">value</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">IntField</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="n">oldData</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">value</span>

        <span class="k">class</span> <span class="nc">FlowerPotEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">updateFlowerPot</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">oldData</span> <span class="o">!=</span> <span class="n">Data</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="n">oldItem</span> <span class="o">!=</span> <span class="n">Item</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Item&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">Item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="n">op</span> <span class="o">=</span> <span class="n">FlowerPotEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">okBtn</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">updateFlowerPot</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">((</span><span class="n">titleLabel</span><span class="p">,</span> <span class="n">Row</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Item&quot;</span><span class="p">),</span> <span class="n">Item</span><span class="p">)),</span> <span class="n">Row</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">),</span> <span class="n">Data</span><span class="p">)),</span> <span class="n">okBtn</span><span class="p">,</span> <span class="n">cancel</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

    <span class="nd">@mceutils.alertException</span>
    <span class="k">def</span> <span class="nf">editEnchantmentTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Dialog</span><span class="p">()</span>
        <span class="n">tileEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
        <span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tileEntity</span><span class="p">:</span>
            <span class="n">tileEntity</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Compound</span><span class="p">()</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">MCEDIT_DEFS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EnchantTable&quot;</span><span class="p">,</span> <span class="s">&quot;EnchantTable&quot;</span><span class="p">))</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_Int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>

        <span class="n">titleLabel</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="s">&quot;Edit Enchantment Table&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;CustomName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">TextFieldWrapped</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">value</span>

        <span class="k">class</span> <span class="nc">EnchantmentTableEditOperation</span><span class="p">(</span><span class="n">Operation</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="n">tool</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span> <span class="o">=</span> <span class="n">undoBackupEntityTag</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordUndo</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saving</span><span class="p">:</span>
                    <span class="n">alert</span><span class="p">(</span><span class="s">&quot;Cannot perform action while saving is taking place&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canUndo</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">addTileEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redoBackupEntityTag</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">BoundingBox</span><span class="p">(</span><span class="n">pymclevel</span><span class="o">.</span><span class="n">TileEntity</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">tileEntity</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">updateEnchantmentTable</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">oldName</span> <span class="o">!=</span> <span class="n">name</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;CustomName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">TAG_String</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="n">op</span> <span class="o">=</span> <span class="n">EnchantmentTableEditOperation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addOperation</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">canUndo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">addUnsavedEdit</span><span class="p">()</span>

                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">dirty</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>

        <span class="n">okBtn</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">updateEnchantmentTable</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">panel</span><span class="o">.</span><span class="n">dismiss</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Column</span><span class="p">((</span><span class="n">titleLabel</span><span class="p">,</span> <span class="n">Row</span><span class="p">((</span><span class="n">Label</span><span class="p">(</span><span class="s">&quot;Custom Name&quot;</span><span class="p">),</span> <span class="n">name</span><span class="p">)),</span> <span class="n">okBtn</span><span class="p">,</span> <span class="n">cancel</span><span class="p">)))</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">shrink_wrap</span><span class="p">()</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

    <span class="n">should_lock</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="CameraViewport.rightClickDown"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.rightClickDown">[docs]</a>    <span class="k">def</span> <span class="nf">rightClickDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="c"># self.rightMouseDragStart = datetime.now()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">should_lock</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggleMouseLook</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CameraViewport.rightClickUp"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.rightClickUp">[docs]</a>    <span class="k">def</span> <span class="nf">rightClickUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">get_top_widget</span><span class="p">()</span><span class="o">.</span><span class="n">is_modal</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_lock</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">should_lock</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggleMouseLook</span><span class="p">()</span>
        <span class="c"># if self.rightMouseDragStart is None:</span>
        <span class="c">#     return</span>

        <span class="c"># td = datetime.now() - self.rightMouseDragStart</span>
        <span class="c"># # except AttributeError:</span>
        <span class="c"># # return</span>
        <span class="c"># # print &quot;RightClickUp: &quot;, td</span>
        <span class="c"># if td.microseconds &gt; 180000:</span>
        <span class="c">#     self.mouseLookOff()</span>
</div>
<div class="viewcode-block" id="CameraViewport.leftClickDown"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.leftClickDown">[docs]</a>    <span class="k">def</span> <span class="nf">leftClickDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">toolMouseDown</span><span class="p">(</span><span class="n">evt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">num_clicks</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">distance2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">))</span>

            <span class="n">point</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span>
            <span class="k">if</span> <span class="n">point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">point</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">selectionTool</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">blockAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">distance2</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">blockEditors</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">MonsterSpawner</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editMonsterSpawner</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">Sign</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editSign</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">WallSign</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editSign</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">MobHead</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editSkull</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">CommandBlock</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editCommandBlock</span><span class="p">,</span>
                                <span class="mi">210</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editCommandBlock</span><span class="p">,</span>
                                <span class="mi">211</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editCommandBlock</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">Jukebox</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editJukebox</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">NoteBlock</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editNoteBlock</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">FlowerPot</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editFlowerPot</span><span class="p">,</span>
                                <span class="n">pymclevel</span><span class="o">.</span><span class="n">alphaMaterials</span><span class="o">.</span><span class="n">EnchantmentTable</span><span class="o">.</span><span class="n">ID</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">editEnchantmentTable</span>
                            <span class="p">}</span>
                            <span class="n">edit</span> <span class="o">=</span> <span class="n">blockEditors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">edit</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">endSelection</span><span class="p">()</span>
                                <span class="n">edit</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c"># detect &quot;container&quot; tiles</span>
                                <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">te</span> <span class="ow">and</span> <span class="s">&quot;Items&quot;</span> <span class="ow">in</span> <span class="n">te</span> <span class="ow">and</span> <span class="s">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">te</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">endSelection</span><span class="p">()</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">editContainer</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">te</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">ChunkNotPresent</span><span class="p">):</span>
                        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="CameraViewport.leftClickUp"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.leftClickUp">[docs]</a>    <span class="k">def</span> <span class="nf">leftClickUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">toolMouseUp</span><span class="p">(</span><span class="n">evt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span><span class="p">)</span>

    <span class="c"># --- Event handlers ---</span>
</div>
<div class="viewcode-block" id="CameraViewport.mouse_down"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouse_down">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">remapMouseButton</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Mouse down </span><span class="si">%d</span><span class="s"> @ </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span> <span class="ow">and</span> <span class="n">evt</span><span class="o">.</span><span class="n">ctrl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rightClickDown</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leftClickDown</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightClickDown</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span> <span class="ow">and</span> <span class="n">evt</span><span class="o">.</span><span class="n">alt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leftClickDown</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s">&#39;keyname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;mouse{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">key_down</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">focus_on</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="c"># self.focus_switch = None</span>
</div>
<div class="viewcode-block" id="CameraViewport.mouse_up"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouse_up">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">remapMouseButton</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Mouse up   </span><span class="si">%d</span><span class="s"> @ </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">evt</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span> <span class="ow">and</span> <span class="n">evt</span><span class="o">.</span><span class="n">ctrl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rightClickUp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leftClickUp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightClickUp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span> <span class="ow">and</span> <span class="n">evt</span><span class="o">.</span><span class="n">alt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leftClickUp</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s">&#39;keyname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;mouse{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">key_up</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CameraViewport.mouse_drag"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouse_drag">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_drag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">mouse_drag</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
</div>
    <span class="n">lastRendererUpdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<div class="viewcode-block" id="CameraViewport.mouse_move"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.mouse_move">[docs]</a>    <span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">sensitivityAdjust</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">mouseSpeed</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">/</span> <span class="mf">10.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">mouseEntered</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseMovesCamera</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">should_lock</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">pitchAdjust</span> <span class="o">=</span> <span class="n">sensitivityAdjust</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">rel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invertMousePitch</span><span class="p">:</span>
                <span class="n">pitchAdjust</span> <span class="o">=</span> <span class="o">-</span><span class="n">pitchAdjust</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span> <span class="o">+=</span> <span class="n">sensitivityAdjust</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">rel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">+=</span> <span class="n">pitchAdjust</span>
            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastRendererUpdate</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500000</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">loadNearbyChunks</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lastRendererUpdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

                <span class="c"># adjustLimit = 2</span>

                <span class="c"># self.oldMousePosition = (x, y)</span>
                <span class="c"># if (self.startingMousePosition[0] - x &gt; adjustLimit or self.startingMousePosition[1] - y &gt; adjustLimit or</span>
                <span class="c"># self.startingMousePosition[0] - x &lt; -adjustLimit or self.startingMousePosition[1] - y &lt; -adjustLimit):</span>
                <span class="c"># mouse.set_pos(*self.startingMousePosition)</span>
                <span class="c">#    event.get(MOUSEMOTION)</span>
                <span class="c">#    self.oldMousePosition = (self.startingMousePosition)</span>

        <span class="c">#if config.settings.showCommands.get():</span>
</div>
<div class="viewcode-block" id="CameraViewport.activeevent"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.activeevent">[docs]</a>    <span class="k">def</span> <span class="nf">activeevent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">state</span> <span class="o">&amp;</span> <span class="mh">0x2</span> <span class="ow">and</span> <span class="n">evt</span><span class="o">.</span><span class="n">gain</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avoidMouseJumpBug</span> <span class="o">=</span> <span class="mi">1</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tooltipText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#if self.hoveringCommandBlock[0] and (self.editor.currentTool is self.editor.selectionTool and self.editor.selectionTool.infoKey == 0):</span>
        <span class="c">#    return self.hoveringCommandBlock[1] or &quot;[Empty]&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">selectionTool</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">selectionTool</span><span class="o">.</span><span class="n">infoKey</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">showQuickBlockInfo</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span>
            <span class="k">if</span> <span class="n">point</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_info_parsers</span> <span class="ow">or</span> <span class="p">(</span><span class="n">BlockInfoParser</span><span class="o">.</span><span class="n">last_level</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">block_info_parsers</span> <span class="o">=</span> <span class="n">BlockInfoParser</span><span class="o">.</span><span class="n">get_parsers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">)</span>
                <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">blockAt</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_info_parsers</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_info_parsers</span><span class="p">[</span><span class="n">block</span><span class="p">](</span><span class="n">point</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span><span class="o">.</span><span class="n">worldTooltipText</span>

    <span class="n">floorQuad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="o">-</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4000.0</span><span class="p">),</span>
                             <span class="p">(</span><span class="o">-</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">),</span>
                             <span class="p">(</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">),</span>
                             <span class="p">(</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4000.0</span><span class="p">),</span>
                            <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CameraViewport.updateFloorQuad"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.updateFloorQuad">[docs]</a>    <span class="k">def</span> <span class="nf">updateFloorQuad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">floorQuad</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4000.0</span><span class="p">),</span>
                     <span class="p">(</span><span class="o">-</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">),</span>
                     <span class="p">(</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">),</span>
                     <span class="p">(</span><span class="mf">4000.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4000.0</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">floorQuad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">floorQuad</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">inSpace</span><span class="p">():</span>
            <span class="n">floorQuad</span> <span class="o">*=</span> <span class="mf">8.0</span>
        <span class="n">floorQuad</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floorQuad</span> <span class="o">=</span> <span class="n">floorQuad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floorQuadList</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CameraViewport.drawFloorQuad"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.drawFloorQuad">[docs]</a>    <span class="k">def</span> <span class="nf">drawFloorQuad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">floorQuadList</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawFloorQuad</span><span class="p">)</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_drawCeiling</span><span class="p">():</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">minz</span> <span class="o">=</span> <span class="n">minx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">256</span>
        <span class="n">maxz</span> <span class="o">=</span> <span class="n">maxx</span> <span class="o">=</span> <span class="mi">256</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">minz</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxz</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minz</span><span class="p">,</span> <span class="n">maxz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">minx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">maxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glColor</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertexPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">))</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDepthMask</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_LINES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDepthMask</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="CameraViewport.drawCeiling"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.drawCeiling">[docs]</a>    <span class="k">def</span> <span class="nf">drawCeiling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
        <span class="c"># GL.glPushMatrix()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span>
        <span class="n">x</span> <span class="o">-=</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">16</span>
        <span class="n">z</span> <span class="o">-=</span> <span class="n">z</span> <span class="o">%</span> <span class="mi">16</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">Height</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ceilingList</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawCeiling</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glTranslate</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
</div>
    <span class="n">_floorQuadList</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">floorQuadList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floorQuadList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_floorQuadList</span> <span class="o">=</span> <span class="n">glutils</span><span class="o">.</span><span class="n">DisplayList</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floorQuadList</span>

    <span class="n">_ceilingList</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ceilingList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ceilingList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ceilingList</span> <span class="o">=</span> <span class="n">glutils</span><span class="o">.</span><span class="n">DisplayList</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ceilingList</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">floorColor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawSky</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.15</span>

            <span class="c"># floorColor = (0.0, 0.0, 1.0, 0.1)</span>

    <span class="k">def</span> <span class="nf">_drawFloorQuad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDepthMask</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPolygonOffset</span><span class="p">(</span><span class="n">DepthOffset</span><span class="o">.</span><span class="n">ChunkMarkers</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DepthOffset</span><span class="o">.</span><span class="n">ChunkMarkers</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glVertexPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floorQuad</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glColor</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">floorColor</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">gl</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BLEND</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_TEST</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_POLYGON_OFFSET_FILL</span><span class="p">):</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drawSky</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawSky</span>

    <span class="nd">@drawSky.setter</span>
    <span class="k">def</span> <span class="nf">drawSky</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawSky</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skyList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skyList</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floorQuadList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_floorQuadList</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>

    <span class="n">skyList</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CameraViewport.drawSkyBackground"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.drawSkyBackground">[docs]</a>    <span class="k">def</span> <span class="nf">drawSkyBackground</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skyList</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skyList</span> <span class="o">=</span> <span class="n">glutils</span><span class="o">.</span><span class="n">DisplayList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skyList</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drawSkyBackground</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_drawSkyBackground</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glLoadIdentity</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glLoadIdentity</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>

        <span class="n">quad</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimNo</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;uint8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;uint8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
                                  <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;uint8&#39;</span><span class="p">)</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BLEND</span><span class="p">)</span>

            <span class="n">GL</span><span class="o">.</span><span class="n">glVertexPointer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">quad</span><span class="p">)</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glColorPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_BLEND</span><span class="p">)</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glPopMatrix</span><span class="p">()</span>

    <span class="n">enableMouseLag</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">enableMouseLag</span><span class="o">.</span><span class="n">property</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">drawFog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_drawFog</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">inSpace</span><span class="p">()</span>

    <span class="nd">@drawFog.setter</span>
    <span class="k">def</span> <span class="nf">drawFog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawFog</span> <span class="o">=</span> <span class="n">val</span>

    <span class="n">fogColor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
    <span class="n">fogColorBlack</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CameraViewport.enableFog"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.enableFog">[docs]</a>    <span class="k">def</span> <span class="nf">enableFog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FOG</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawSky</span><span class="p">:</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glFogfv</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FOG_COLOR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fogColor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">GL</span><span class="o">.</span><span class="n">glFogfv</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FOG_COLOR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fogColorBlack</span><span class="p">)</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glFogf</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FOG_DENSITY</span><span class="p">,</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fogIntensity</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="CameraViewport.disableFog"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.disableFog">[docs]</a>    <span class="k">def</span> <span class="nf">disableFog</span><span class="p">():</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDisable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_FOG</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CameraViewport.getCameraPoint"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.getCameraPoint">[docs]</a>    <span class="k">def</span> <span class="nf">getCameraPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span><span class="o">.</span><span class="n">cameraDistance</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">distance</span><span class="p">)),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">cameraPosition</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">cameraVector</span><span class="p">)]</span>
</div>
    <span class="n">blockFaceUnderCursor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">viewingFrustum</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CameraViewport.setup_projection"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.setup_projection">[docs]</a>    <span class="k">def</span> <span class="nf">setup_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">inSpace</span><span class="p">():</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="mf">8.0</span>
        <span class="n">GLU</span><span class="o">.</span><span class="n">gluPerspective</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fov</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">near</span> <span class="o">*</span> <span class="n">distance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">far</span> <span class="o">*</span> <span class="n">distance</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CameraViewport.setup_modelview"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.setup_modelview">[docs]</a>    <span class="k">def</span> <span class="nf">setup_modelview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModelview</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CameraViewport.gl_draw"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.gl_draw">[docs]</a>    <span class="k">def</span> <span class="nf">gl_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickCamera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">frameStartTime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">cameraInputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">inSpace</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CameraViewport.render"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CameraViewport.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewingFrustum</span> <span class="o">=</span> <span class="n">frustum</span><span class="o">.</span><span class="n">Frustum</span><span class="o">.</span><span class="n">fromViewingMatrix</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">superSecretSettings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">drawStars</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawSky</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawSkyBackground</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawFog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableFog</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawFloorQuad</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">viewingFrustum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewingFrustum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showCeiling</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">inSpace</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawCeiling</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateBlockFaceUnderCursor</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">ChunkNotPresent</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Updating cursor block: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">update_tooltip</span><span class="p">()</span>

            <span class="p">(</span><span class="n">blockPosition</span><span class="p">,</span> <span class="n">faceDirection</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockFaceUnderCursor</span>
            <span class="k">if</span> <span class="bp">None</span> <span class="o">!=</span> <span class="n">blockPosition</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">updateInspectionString</span><span class="p">(</span><span class="n">blockPosition</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_widget</span><span class="p">(</span><span class="n">mouse</span><span class="o">.</span><span class="n">get_pos</span><span class="p">())</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">currentTool</span>
                    <span class="k">if</span> <span class="n">ct</span><span class="p">:</span>
                        <span class="n">ct</span><span class="o">.</span><span class="n">drawTerrainReticle</span><span class="p">()</span>
                        <span class="n">ct</span><span class="o">.</span><span class="n">drawToolReticle</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">drawWireCubeReticle</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">tools</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">drawTerrainMarkers</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">drawToolMarkers</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawFog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableFog</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compassToggle</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span> <span class="o">=</span> <span class="n">CompassOverlay</span><span class="p">()</span>

            <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="s">&#39;copyPanel&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span><span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">mainViewport</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span><span class="o">.</span><span class="n">yawPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span> <span class="mi">0</span>

            <span class="k">with</span> <span class="n">gl</span><span class="o">.</span><span class="n">glPushMatrix</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_PROJECTION</span><span class="p">):</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">glLoadIdentity</span><span class="p">()</span>
                <span class="n">GL</span><span class="o">.</span><span class="n">glOrtho</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compass</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="n">_compass</span> <span class="o">=</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="BlockInfoParser"><a class="viewcode-back" href="../../viewports.html#viewports.camera.BlockInfoParser">[docs]</a><span class="k">class</span> <span class="nc">BlockInfoParser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">last_level</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">nbt_ending</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">Press ALT for NBT&quot;</span>
    <span class="n">edit_ending</span> <span class="o">=</span> <span class="s">&quot;, Double-Click to Edit&quot;</span>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="BlockInfoParser.get_parsers"><a class="viewcode-back" href="../../viewports.html#viewports.camera.BlockInfoParser.get_parsers">[docs]</a>    <span class="k">def</span> <span class="nf">get_parsers</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">last_level</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">level</span>
        <span class="n">parser_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">subcls</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">subcls</span><span class="p">(</span><span class="n">editor</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">blocks</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">parser_map</span><span class="p">[</span><span class="n">blocks</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">parse_info</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">:</span>
                    <span class="n">parser_map</span><span class="p">[</span><span class="n">block</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">parse_info</span>
        <span class="k">return</span> <span class="n">parser_map</span>
    </div>
<div class="viewcode-block" id="BlockInfoParser.getBlocks"><a class="viewcode-back" href="../../viewports.html#viewports.camera.BlockInfoParser.getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BlockInfoParser.parse_info"><a class="viewcode-back" href="../../viewports.html#viewports.camera.BlockInfoParser.parse_info">[docs]</a>    <span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="SpawnerInfoParser"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SpawnerInfoParser">[docs]</a><span class="k">class</span> <span class="nc">SpawnerInfoParser</span><span class="p">(</span><span class="n">BlockInfoParser</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        
<div class="viewcode-block" id="SpawnerInfoParser.getBlocks"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SpawnerInfoParser.getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:mob_spawner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span>
    </div>
<div class="viewcode-block" id="SpawnerInfoParser.parse_info"><a class="viewcode-back" href="../../viewports.html#viewports.camera.SpawnerInfoParser.parse_info">[docs]</a>    <span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">tile_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tile_entity</span><span class="p">:</span>
            <span class="n">spawn_data</span> <span class="o">=</span> <span class="n">tile_entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SpawnData&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">spawn_data</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">spawn_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EntityId&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">spawn_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">id</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;Malformed spawn data: could not find &#39;EntityId&#39; or &#39;id&#39; tag.&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; Spawner&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
        <span class="k">return</span> <span class="s">&quot;[Empty]&quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
    </div></div>
<div class="viewcode-block" id="JukeboxInfoParser"><a class="viewcode-back" href="../../viewports.html#viewports.camera.JukeboxInfoParser">[docs]</a><span class="k">class</span> <span class="nc">JukeboxInfoParser</span><span class="p">(</span><span class="n">BlockInfoParser</span><span class="p">):</span>
    <span class="n">id_records</span> <span class="o">=</span> <span class="p">{</span>
               <span class="mi">2256</span><span class="p">:</span> <span class="s">&quot;13&quot;</span><span class="p">,</span>
               <span class="mi">2257</span><span class="p">:</span> <span class="s">&quot;Cat&quot;</span><span class="p">,</span>
               <span class="mi">2258</span><span class="p">:</span> <span class="s">&quot;Blocks&quot;</span><span class="p">,</span>
               <span class="mi">2259</span><span class="p">:</span> <span class="s">&quot;Chirp&quot;</span><span class="p">,</span>
               <span class="mi">2260</span><span class="p">:</span> <span class="s">&quot;Far&quot;</span><span class="p">,</span>
               <span class="mi">2261</span><span class="p">:</span> <span class="s">&quot;Mall&quot;</span><span class="p">,</span>
               <span class="mi">2262</span><span class="p">:</span> <span class="s">&quot;Mellohi&quot;</span><span class="p">,</span>
               <span class="mi">2263</span><span class="p">:</span> <span class="s">&quot;Stal&quot;</span><span class="p">,</span>
               <span class="mi">2264</span><span class="p">:</span> <span class="s">&quot;Strad&quot;</span><span class="p">,</span>
               <span class="mi">2265</span><span class="p">:</span> <span class="s">&quot;Ward&quot;</span><span class="p">,</span>
               <span class="mi">2266</span><span class="p">:</span> <span class="s">&quot;11&quot;</span><span class="p">,</span>
               <span class="mi">2267</span><span class="p">:</span> <span class="s">&quot;Wait&quot;</span>
    <span class="p">}</span>
    
    <span class="n">name_records</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;minecraft:record_13&quot;</span><span class="p">:</span> <span class="s">&quot;13&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_cat&quot;</span><span class="p">:</span> <span class="s">&quot;Cat&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_blocks&quot;</span><span class="p">:</span> <span class="s">&quot;Blocks&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_chirp&quot;</span><span class="p">:</span> <span class="s">&quot;Chirp&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_far&quot;</span><span class="p">:</span> <span class="s">&quot;Far&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_mall&quot;</span><span class="p">:</span> <span class="s">&quot;Mall&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_mellohi&quot;</span><span class="p">:</span> <span class="s">&quot;Mellohi&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_stal&quot;</span><span class="p">:</span> <span class="s">&quot;Stal&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_strad&quot;</span><span class="p">:</span> <span class="s">&quot;Strad&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_ward&quot;</span><span class="p">:</span> <span class="s">&quot;Ward&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_11&quot;</span><span class="p">:</span> <span class="s">&quot;11&quot;</span><span class="p">,</span>
                <span class="s">&quot;minecraft:record_wait&quot;</span><span class="p">:</span> <span class="s">&quot;Wait&quot;</span>
    <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        
<div class="viewcode-block" id="JukeboxInfoParser.getBlocks"><a class="viewcode-back" href="../../viewports.html#viewports.camera.JukeboxInfoParser.getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:jukebox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span>
    </div>
<div class="viewcode-block" id="JukeboxInfoParser.parse_info"><a class="viewcode-back" href="../../viewports.html#viewports.camera.JukeboxInfoParser.parse_info">[docs]</a>    <span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">tile_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tile_entity</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&quot;Record&quot;</span> <span class="ow">in</span> <span class="n">tile_entity</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">tile_entity</span><span class="p">[</span><span class="s">&quot;Record&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_records</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; Record&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
            <span class="k">elif</span> <span class="s">&quot;RecordItem&quot;</span> <span class="ow">in</span> <span class="n">tile_entity</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">tile_entity</span><span class="p">[</span><span class="s">&quot;RecordItem&quot;</span><span class="p">][</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_records</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_records</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; Record&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
        <span class="k">return</span> <span class="s">&quot;[No Record]&quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
    </div></div>
<div class="viewcode-block" id="CommandBlockInfoParser"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CommandBlockInfoParser">[docs]</a><span class="k">class</span> <span class="nc">CommandBlockInfoParser</span><span class="p">(</span><span class="n">BlockInfoParser</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        
<div class="viewcode-block" id="CommandBlockInfoParser.getBlocks"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CommandBlockInfoParser.getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:command_block&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:repeating_command_block&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:chain_command_block&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span>
                <span class="p">]</span>
    </div>
<div class="viewcode-block" id="CommandBlockInfoParser.parse_info"><a class="viewcode-back" href="../../viewports.html#viewports.camera.CommandBlockInfoParser.parse_info">[docs]</a>    <span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">tile_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tile_entity</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">tile_entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Command&quot;</span><span class="p">,</span> <span class="n">TAG_String</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">value</span><span class="p">[:</span><span class="mi">1500</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">**COMMAND IS TOO LONG TO SHOW MORE**&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
                <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
        <span class="k">return</span> <span class="s">&quot;[Empty Command Block]&quot;</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
    </div></div>
<div class="viewcode-block" id="ContainerInfoParser"><a class="viewcode-back" href="../../viewports.html#viewports.camera.ContainerInfoParser">[docs]</a><span class="k">class</span> <span class="nc">ContainerInfoParser</span><span class="p">(</span><span class="n">BlockInfoParser</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
        
<div class="viewcode-block" id="ContainerInfoParser.getBlocks"><a class="viewcode-back" href="../../viewports.html#viewports.camera.ContainerInfoParser.getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:dispenser&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:chest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:furnace&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:lit_furnace&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:trapped_chest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:hopper&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:dropper&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="s">&quot;minecraft:brewing_stand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ID</span>
                <span class="p">]</span>
        </div>
<div class="viewcode-block" id="ContainerInfoParser.parse_info"><a class="viewcode-back" href="../../viewports.html#viewports.camera.ContainerInfoParser.parse_info">[docs]</a>    <span class="k">def</span> <span class="nf">parse_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">tile_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">tileEntityAt</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tile_entity</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;Contains {} Items&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tile_entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Items&quot;</span><span class="p">,</span> <span class="p">[])))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
        <span class="k">return</span> <span class="s">&quot;[Empty Container]&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbt_ending</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_ending</span>
</div></div>
<div class="viewcode-block" id="unproject"><a class="viewcode-back" href="../../viewports.html#viewports.camera.unproject">[docs]</a><span class="k">def</span> <span class="nf">unproject</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GLU</span><span class="o">.</span><span class="n">gluUnProject</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c"># projection failed</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span></div>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">MCEdit-Unified v1.5.6.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../index.html" >Module code</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2010-2014 David Rio Vierra (Codewarrior0). 2014-2016 MCEdit-Unified Team and all of the contributers. All Rights Reserved to their respective ownership..
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>