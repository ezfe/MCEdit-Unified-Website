<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>mce &mdash; MCEdit-Unified v1.5.6.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../static/css/bootstrap3/bootswatch-yeti.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" href="../static/css/adjust_theme/bootswatch-yeti.css" type="text/css" />

<link rel="stylesheet" href="../static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../',
            VERSION:     'v1.5.6.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../static/favicon.ico"/>
    <link rel="top" title="MCEdit-Unified v1.5.6.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">MCEdit-Unified v1.5.6.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="index.html" accesskey="U">Module code</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../index.html">
      <img class="logo" src="../static/favicon.png" alt="Logo"/>
    </a></p>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for mce</h1><div class="highlight"><pre>
<span class="c"># !/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">pymclevel.mclevelbase</span>
<span class="kn">import</span> <span class="nn">pymclevel.mclevel</span>
<span class="kn">import</span> <span class="nn">pymclevel.materials</span>
<span class="kn">import</span> <span class="nn">pymclevel.infiniteworld</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pymclevel.box</span> <span class="kn">import</span> <span class="n">BoundingBox</span><span class="p">,</span> <span class="n">Vector</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">bincount</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">codecs</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>

<span class="n">mclevelbase</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">mclevelbase</span>
<span class="n">mclevel</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">mclevel</span>
<span class="n">materials</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">materials</span>
<span class="n">infiniteworld</span> <span class="o">=</span> <span class="n">pymclevel</span><span class="o">.</span><span class="n">infiniteworld</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">readline</span>  <span class="c"># if available, used by raw_input()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="UsageError"><a class="viewcode-back" href="../mce.html#mce.UsageError">[docs]</a><span class="k">class</span> <span class="nc">UsageError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="BlockMatchError"><a class="viewcode-back" href="../mce.html#mce.BlockMatchError">[docs]</a><span class="k">class</span> <span class="nc">BlockMatchError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="PlayerNotFound"><a class="viewcode-back" href="../mce.html#mce.PlayerNotFound">[docs]</a><span class="k">class</span> <span class="nc">PlayerNotFound</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="mce"><a class="viewcode-back" href="../mce.html#mce.mce">[docs]</a><span class="k">class</span> <span class="nc">mce</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Block commands:</span>
<span class="sd">       {commandPrefix}clone &lt;sourceBox&gt; &lt;destPoint&gt; [noair] [nowater]</span>
<span class="sd">       {commandPrefix}fill &lt;blockType&gt; [ &lt;box&gt; ]</span>
<span class="sd">       {commandPrefix}replace &lt;blockType&gt; [with] &lt;newBlockType&gt; [ &lt;box&gt; ]</span>

<span class="sd">       {commandPrefix}export &lt;filename&gt; &lt;sourceBox&gt;</span>
<span class="sd">       {commandPrefix}import &lt;filename&gt; &lt;destPoint&gt; [noair] [nowater]</span>

<span class="sd">       {commandPrefix}createChest &lt;point&gt; &lt;item&gt; [ &lt;count&gt; ]</span>
<span class="sd">       {commandPrefix}analyze</span>

<span class="sd">    Player commands:</span>
<span class="sd">       {commandPrefix}player [ &lt;player&gt; [ &lt;point&gt; ] ]</span>
<span class="sd">       {commandPrefix}spawn [ &lt;point&gt; ]</span>

<span class="sd">    Entity commands:</span>
<span class="sd">       {commandPrefix}removeEntities [ &lt;EntityID&gt; ]</span>
<span class="sd">       {commandPrefix}dumpSigns [ &lt;filename&gt; ]</span>
<span class="sd">       {commandPrefix}dumpChests [ &lt;filename&gt; ]</span>

<span class="sd">    Chunk commands:</span>
<span class="sd">       {commandPrefix}createChunks &lt;box&gt;</span>
<span class="sd">       {commandPrefix}deleteChunks &lt;box&gt;</span>
<span class="sd">       {commandPrefix}prune &lt;box&gt;</span>
<span class="sd">       {commandPrefix}relight [ &lt;box&gt; ]</span>

<span class="sd">    World commands:</span>
<span class="sd">       {commandPrefix}create &lt;filename&gt;</span>
<span class="sd">       {commandPrefix}dimension [ &lt;dim&gt; ]</span>
<span class="sd">       {commandPrefix}degrief</span>
<span class="sd">       {commandPrefix}time [ &lt;time&gt; ]</span>
<span class="sd">       {commandPrefix}worldsize</span>
<span class="sd">       {commandPrefix}heightmap &lt;filename&gt;</span>
<span class="sd">       {commandPrefix}randomseed [ &lt;seed&gt; ]</span>
<span class="sd">       {commandPrefix}gametype [ &lt;player&gt; [ &lt;gametype&gt; ] ]</span>

<span class="sd">    Editor commands:</span>
<span class="sd">       {commandPrefix}save</span>
<span class="sd">       {commandPrefix}reload</span>
<span class="sd">       {commandPrefix}load &lt;filename&gt; | &lt;world number&gt;</span>
<span class="sd">       {commandPrefix}execute &lt;filename&gt;</span>
<span class="sd">       {commandPrefix}quit</span>

<span class="sd">    Informational:</span>
<span class="sd">       {commandPrefix}blocks [ &lt;block name&gt; | &lt;block ID&gt; ]</span>
<span class="sd">       {commandPrefix}help [ &lt;command&gt; ]</span>

<span class="sd">    **IMPORTANT**</span>
<span class="sd">       {commandPrefix}box</span>

<span class="sd">       Type &#39;box&#39; to learn how to specify points and areas.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random_seed</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;MCE_RANDOM_SEED&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">last_played</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;MCE_LAST_PLAYED&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<div class="viewcode-block" id="mce.commandUsage"><a class="viewcode-back" href="../mce.html#mce.mce.commandUsage">[docs]</a>    <span class="k">def</span> <span class="nf">commandUsage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="s">&quot; returns usage info for the named command - just give the docstring for the handler func &quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">__doc__</span>
</div>
    <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&quot;clone&quot;</span><span class="p">,</span>
        <span class="s">&quot;fill&quot;</span><span class="p">,</span>
        <span class="s">&quot;replace&quot;</span><span class="p">,</span>

        <span class="s">&quot;export&quot;</span><span class="p">,</span>
        <span class="s">&quot;execute&quot;</span><span class="p">,</span>
        <span class="s">&quot;import&quot;</span><span class="p">,</span>

        <span class="s">&quot;createchest&quot;</span><span class="p">,</span>

        <span class="s">&quot;player&quot;</span><span class="p">,</span>
        <span class="s">&quot;spawn&quot;</span><span class="p">,</span>

        <span class="s">&quot;removeentities&quot;</span><span class="p">,</span>
        <span class="s">&quot;dumpsigns&quot;</span><span class="p">,</span>
        <span class="s">&quot;dumpchests&quot;</span><span class="p">,</span>

        <span class="s">&quot;createchunks&quot;</span><span class="p">,</span>
        <span class="s">&quot;deletechunks&quot;</span><span class="p">,</span>
        <span class="s">&quot;prune&quot;</span><span class="p">,</span>
        <span class="s">&quot;relight&quot;</span><span class="p">,</span>

        <span class="s">&quot;create&quot;</span><span class="p">,</span>
        <span class="s">&quot;degrief&quot;</span><span class="p">,</span>
        <span class="s">&quot;time&quot;</span><span class="p">,</span>
        <span class="s">&quot;worldsize&quot;</span><span class="p">,</span>
        <span class="s">&quot;heightmap&quot;</span><span class="p">,</span>
        <span class="s">&quot;randomseed&quot;</span><span class="p">,</span>
        <span class="s">&quot;gametype&quot;</span><span class="p">,</span>

        <span class="s">&quot;save&quot;</span><span class="p">,</span>
        <span class="s">&quot;load&quot;</span><span class="p">,</span>
        <span class="s">&quot;reload&quot;</span><span class="p">,</span>
        <span class="s">&quot;dimension&quot;</span><span class="p">,</span>
        <span class="s">&quot;repair&quot;</span><span class="p">,</span>

        <span class="s">&quot;quit&quot;</span><span class="p">,</span>
        <span class="s">&quot;exit&quot;</span><span class="p">,</span>

        <span class="s">&quot;help&quot;</span><span class="p">,</span>
        <span class="s">&quot;blocks&quot;</span><span class="p">,</span>
        <span class="s">&quot;analyze&quot;</span><span class="p">,</span>
        <span class="s">&quot;region&quot;</span><span class="p">,</span>

        <span class="s">&quot;debug&quot;</span><span class="p">,</span>
        <span class="s">&quot;log&quot;</span><span class="p">,</span>
        <span class="s">&quot;box&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">needsSave</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="mce.readInt"><a class="viewcode-back" href="../mce.html#mce.mce.readInt">[docs]</a>    <span class="k">def</span> <span class="nf">readInt</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Cannot understand numeric input&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="mce.prettySplit"><a class="viewcode-back" href="../mce.html#mce.mce.prettySplit">[docs]</a>    <span class="k">def</span> <span class="nf">prettySplit</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
        <span class="n">cmdstring</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">lex</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">shlex</span><span class="p">(</span><span class="n">cmdstring</span><span class="p">)</span>
        <span class="n">lex</span><span class="o">.</span><span class="n">whitespace_split</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">lex</span><span class="o">.</span><span class="n">whitespace</span> <span class="o">+=</span> <span class="s">&quot;(),&quot;</span>

        <span class="n">command</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lex</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mce.readBox"><a class="viewcode-back" href="../mce.html#mce.mce.readBox">[docs]</a>    <span class="k">def</span> <span class="nf">readBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prettySplit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">sourcePoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readIntPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;to&quot;</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sourcePoint2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readIntPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">sourceSize</span> <span class="o">=</span> <span class="n">sourcePoint2</span> <span class="o">-</span> <span class="n">sourcePoint</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sourceSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readIntPoint</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">isPoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sourceSize</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Box size cannot be zero or negative&quot;</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="p">(</span><span class="n">sourcePoint</span><span class="p">,</span> <span class="n">sourceSize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">box</span>
</div>
<div class="viewcode-block" id="mce.readIntPoint"><a class="viewcode-back" href="../mce.html#mce.mce.readIntPoint">[docs]</a>    <span class="k">def</span> <span class="nf">readIntPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">isPoint</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">isPoint</span><span class="p">)</span>
        <span class="n">point</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">floor</span><span class="p">,</span> <span class="n">point</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mce.readPoint"><a class="viewcode-back" href="../mce.html#mce.mce.readPoint">[docs]</a>    <span class="k">def</span> <span class="nf">readPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">isPoint</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prettySplit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isPoint</span> <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">players</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerPosition</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">and</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;delta&quot;</span><span class="p">:</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">y</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">z</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Error decoding point input (expected a number).&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>

        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Error decoding point input (expected more values).&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isPoint</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PlayerNotFound</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">raise</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Error decoding point input (expected a number).&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Error decoding point input (expected more values).&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
</div>
<div class="viewcode-block" id="mce.readBlockInfo"><a class="viewcode-back" href="../mce.html#mce.mce.readBlockInfo">[docs]</a>    <span class="k">def</span> <span class="nf">readBlockInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="n">keyword</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">blocksMatching</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
        <span class="n">blockInfo</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">blockInfo</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c"># eat up more words that possibly specify a block.  stop eating when 0 matching blocks.</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
                <span class="n">newMatches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">blocksMatching</span><span class="p">(</span><span class="n">keyword</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newMatches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">blockInfo</span> <span class="o">=</span> <span class="n">newMatches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newMatches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">matches</span> <span class="o">=</span> <span class="n">newMatches</span>
                    <span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="s">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">keyword</span><span class="p">:</span>
                    <span class="n">blockID</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">blockID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>
                <span class="n">blockInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">blockWithID</span><span class="p">(</span><span class="n">blockID</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">blockInfo</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">blockInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Ambiguous block specifier: &quot;</span><span class="p">,</span> <span class="n">keyword</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;Matches: &quot;</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">defaultName</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">print</span> <span class="s">&quot;{0:3}:{1:&lt;2} : {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">blockData</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;No blocks matched.&quot;</span>
            <span class="k">raise</span> <span class="n">BlockMatchError</span>

        <span class="k">return</span> <span class="n">blockInfo</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="mce.readBlocksToCopy"><a class="viewcode-back" href="../mce.html#mce.mce.readBlocksToCopy">[docs]</a>    <span class="k">def</span> <span class="nf">readBlocksToCopy</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
        <span class="n">blocksToCopy</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">materials</span><span class="o">.</span><span class="n">id_limit</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s">&quot;noair&quot;</span><span class="p">:</span>
                <span class="n">blocksToCopy</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="s">&quot;nowater&quot;</span><span class="p">:</span>
                <span class="n">blocksToCopy</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
                <span class="n">blocksToCopy</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">blocksToCopy</span>
</div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_box</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boxes:</span>

<span class="sd">    Many commands require a &lt;box&gt; as arguments. A box can be specified with</span>
<span class="sd">    a point and a size:</span>
<span class="sd">        (12, 5, 15), (5, 5, 5)</span>

<span class="sd">    or with two points, making sure to put the keyword &quot;to&quot; between them:</span>
<span class="sd">        (12, 5, 15) to (17, 10, 20)</span>

<span class="sd">    The commas and parentheses are not important.</span>
<span class="sd">    You may add them for improved readability.</span>


<span class="sd">        Points:</span>

<span class="sd">    Points and sizes are triplets of numbers ordered X Y Z.</span>
<span class="sd">    X is position north-south, increasing southward.</span>
<span class="sd">    Y is position up-down, increasing upward.</span>
<span class="sd">    Z is position east-west, increasing westward.</span>


<span class="sd">        Players:</span>

<span class="sd">    A player&#39;s name can be used as a point - it will use the</span>
<span class="sd">    position of the player&#39;s head. Use the keyword &#39;delta&#39; after</span>
<span class="sd">    the name to specify a point near the player.</span>

<span class="sd">    Example:</span>
<span class="sd">       codewarrior delta 0 5 0</span>

<span class="sd">    This refers to a point 5 blocks above codewarrior&#39;s head.</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">UsageError</span>

    <span class="k">def</span> <span class="nf">_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span>
        <span class="k">print</span> <span class="s">&quot;Debug&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span> <span class="s">&quot;enabled&quot;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_log</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    log [ &lt;number&gt; ]</span>

<span class="sd">    Get or set the log threshold. 0 logs everything; 50 only logs major errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Cannot understand numeric input.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Log level: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    clone &lt;sourceBox&gt; &lt;destPoint&gt; [noair] [nowater]</span>

<span class="sd">    Clone blocks in a cuboid starting at sourcePoint and extending for</span>
<span class="sd">    sourceSize blocks in each direction. Blocks and entities in the area</span>
<span class="sd">    are cloned at destPoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;clone&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">destPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">destPoint</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">floor</span><span class="p">,</span> <span class="n">destPoint</span><span class="p">))</span>
        <span class="n">blocksToCopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBlocksToCopy</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">tempSchematic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">extractSchematic</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">copyBlocksFrom</span><span class="p">(</span><span class="n">tempSchematic</span><span class="p">,</span> <span class="n">BoundingBox</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">box</span><span class="o">.</span><span class="n">origin</span><span class="p">),</span> <span class="n">destPoint</span><span class="p">,</span> <span class="n">blocksToCopy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;Cloned 0 blocks.&quot;</span>

    <span class="k">def</span> <span class="nf">_fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fill &lt;blockType&gt; [ &lt;box&gt; ]</span>

<span class="sd">    Fill blocks with blockType in a cuboid starting at point and</span>
<span class="sd">    extending for size blocks in each direction. Without a</span>
<span class="sd">    destination, fills the whole world. blockType and may be a</span>
<span class="sd">    number from 0-255 or a name listed by the &#39;blocks&#39; command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;fill&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">blockInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBlockInfo</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">print</span> <span class="s">&quot;Filling with {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockInfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">fillBlocks</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">blockInfo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;Filled {0} blocks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;all&quot;</span> <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">box</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    replace &lt;blockType&gt; [with] &lt;newBlockType&gt; [ &lt;box&gt; ]</span>

<span class="sd">    Replace all blockType blocks with newBlockType in a cuboid</span>
<span class="sd">    starting at point and extending for size blocks in</span>
<span class="sd">    each direction. Without a destination, replaces blocks over</span>
<span class="sd">    the whole world. blockType and newBlockType may be numbers</span>
<span class="sd">    from 0-255 or names listed by the &#39;blocks&#39; command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;replace&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">blockInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBlockInfo</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;with&quot;</span><span class="p">:</span>
            <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">newBlockInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBlockInfo</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">print</span> <span class="s">&quot;Replacing {0} with {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blockInfo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">newBlockInfo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">fillBlocks</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">newBlockInfo</span><span class="p">,</span> <span class="n">blocksToReplace</span><span class="o">=</span><span class="p">[</span><span class="n">blockInfo</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;Done.&quot;</span>

    <span class="k">def</span> <span class="nf">_createchest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    createChest &lt;point&gt; &lt;item&gt; [ &lt;count&gt; ]</span>

<span class="sd">    Create a chest filled with the specified item.</span>
<span class="sd">    Stacks are 64 if count is not given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">point</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
        <span class="n">itemID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readInt</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">64</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readInt</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">chest</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">MCSchematic</span><span class="o">.</span><span class="n">chestWithItemID</span><span class="p">(</span><span class="n">itemID</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">copyBlocksFrom</span><span class="p">(</span><span class="n">chest</span><span class="p">,</span> <span class="n">chest</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        analyze</span>

<span class="sd">        Counts all of the block types in every chunk of the world.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blockCounts</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">65536</span><span class="p">,),</span> <span class="s">&#39;uint64&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Analyzing {0} chunks...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">chunkCount</span><span class="p">)</span>
        <span class="c"># for input to bincount, create an array of uint16s by</span>
        <span class="c"># shifting the data left and adding the blocks</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cPos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="o">*</span><span class="n">cPos</span><span class="p">)</span>
            <span class="n">btypes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;uint16&#39;</span><span class="p">)</span>
            <span class="n">btypes</span> <span class="o">&lt;&lt;=</span> <span class="mi">12</span>
            <span class="n">btypes</span> <span class="o">+=</span> <span class="n">ch</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">bincount</span><span class="p">(</span><span class="n">btypes</span><span class="p">)</span>

            <span class="n">blockCounts</span><span class="p">[:</span><span class="n">counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">counts</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Chunk {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">blockID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">materials</span><span class="o">.</span><span class="n">id_limit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">blockID</span>
                <span class="k">if</span> <span class="n">blockCounts</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">idstring</span> <span class="o">=</span> <span class="s">&quot;({id}:{data})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blockID</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

                    <span class="k">print</span> <span class="s">&quot;{idstring:9} {name:30}: {count:&lt;10}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">idstring</span><span class="o">=</span><span class="n">idstring</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">blockWithID</span><span class="p">(</span><span class="n">blockID</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">count</span><span class="o">=</span><span class="n">blockCounts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    export &lt;filename&gt; &lt;sourceBox&gt;</span>

<span class="sd">    Exports blocks in the specified region to a file in schematic format.</span>
<span class="sd">    This file can be imported with mce or MCEdit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;export&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">tempSchematic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">extractSchematic</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

        <span class="n">tempSchematic</span><span class="o">.</span><span class="n">saveToFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Exported {0} blocks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tempSchematic</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    import &lt;filename&gt; &lt;destPoint&gt; [noair] [nowater]</span>

<span class="sd">    Imports a level or schematic into this world, beginning at destPoint.</span>
<span class="sd">    Supported formats include</span>
<span class="sd">    - Alpha single or multiplayer world folder containing level.dat,</span>
<span class="sd">    - Zipfile containing Alpha world folder,</span>
<span class="sd">    - Classic single-player .mine,</span>
<span class="sd">    - Classic multiplayer server_level.dat,</span>
<span class="sd">    - Indev .mclevel</span>
<span class="sd">    - Schematic from RedstoneSim, MCEdit, mce</span>
<span class="sd">    - .inv from INVEdit (appears as a chest)</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;import&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">destPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="n">blocksToCopy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBlocksToCopy</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">importLevel</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">copyBlocksFrom</span><span class="p">(</span><span class="n">importLevel</span><span class="p">,</span> <span class="n">importLevel</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">destPoint</span><span class="p">,</span> <span class="n">blocksToCopy</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;Imported {0} blocks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">importLevel</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_player</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    player [ &lt;player&gt; [ &lt;point&gt; ] ]</span>

<span class="sd">    Move the named player to the specified point.</span>
<span class="sd">    Without a point, prints the named player&#39;s position.</span>
<span class="sd">    Without a player, prints all players and positions.</span>

<span class="sd">    In a single-player world, the player is named Player.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Players: &quot;</span>
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;    {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerPosition</span><span class="p">(</span><span class="n">player</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">player</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Player {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerPosition</span><span class="p">(</span><span class="n">player</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">setPlayerPosition</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">print</span> <span class="s">&quot;Moved player {0} to {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    spawn [ &lt;point&gt; ]</span>

<span class="sd">    Move the world&#39;s spawn point.</span>
<span class="sd">    Without a point, prints the world&#39;s spawn point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readPoint</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">point</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">floor</span><span class="p">,</span> <span class="n">point</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">setPlayerSpawnPosition</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span> <span class="s">&quot;Moved spawn point to &quot;</span><span class="p">,</span> <span class="n">point</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Spawn point: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">playerSpawnPosition</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_dumpsigns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dumpSigns [ &lt;filename&gt; ]</span>

<span class="sd">    Saves the text and location of every sign in the world to a text file.</span>
<span class="sd">    With no filename, saves signs to &lt;worldname&gt;.signs</span>

<span class="sd">    Output is newline-delimited. 5 lines per sign. Coordinates are</span>
<span class="sd">    on the first line, followed by four lines of sign text. For example:</span>

<span class="sd">        [229, 118, -15]</span>
<span class="sd">        &quot;To boldly go</span>
<span class="sd">        where no man</span>
<span class="sd">        has gone</span>
<span class="sd">        before.&quot;</span>

<span class="sd">    Coordinates are ordered the same as point inputs:</span>
<span class="sd">        [North/South, Down/Up, East/West]</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">displayName</span> <span class="o">+</span> <span class="s">&quot;.signs&quot;</span>

        <span class="c"># We happen to encode the output file in UTF-8 too, although</span>
        <span class="c"># we could use another UTF encoding.  The &#39;-sig&#39; encoding puts</span>
        <span class="c"># a signature at the start of the output file that tools such</span>
        <span class="c"># as Microsoft Windows Notepad and Emacs understand to mean</span>
        <span class="c"># the file has UTF-8 encoding.</span>
        <span class="n">outFile</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8-sig&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Dumping signs...&quot;</span>
        <span class="n">signCount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cPos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="o">*</span><span class="n">cPos</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">mclevelbase</span><span class="o">.</span><span class="n">ChunkMalformed</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">tileEntity</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">TileEntities</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&quot;Sign&quot;</span><span class="p">:</span>
                    <span class="n">signCount</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tileEntity</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;xyz&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                        <span class="n">signText</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Text{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span>
                        <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">signText</span> <span class="o">+</span> <span class="s">u&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Chunk {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Dumped {0} signs to {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">signCount</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    region [rx rz]</span>

<span class="sd">    List region files in this world.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">MCInfdevOldLevel</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">level</span><span class="o">.</span><span class="n">version</span>

        <span class="k">def</span> <span class="nf">getFreeSectors</span><span class="p">(</span><span class="n">rf</span><span class="p">):</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">free</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">freeSectors</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">free</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">return</span> <span class="n">runs</span>

        <span class="k">def</span> <span class="nf">printFreeSectors</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;&quot;</span>
                <span class="k">print</span> <span class="s">&quot;{start:&gt;6}+{count:&lt;4}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()),</span>

            <span class="k">print</span> <span class="s">&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rx</span><span class="p">,</span> <span class="n">rz</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">command</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">print</span> <span class="s">&quot;Calling allChunks to preload region files: </span><span class="si">%d</span><span class="s"> chunks&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">)</span>
                <span class="n">rf</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">regionFiles</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">rf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Region {rx},{rz} not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
                    <span class="k">return</span>

                <span class="k">print</span> <span class="s">&quot;Region {rx:6}, {rz:6}: {used}/{sectors} sectors&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">used</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">usedSectors</span><span class="p">,</span>
                                                                               <span class="n">sectors</span><span class="o">=</span><span class="n">rf</span><span class="o">.</span><span class="n">sectorCount</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;Offset Table:&quot;</span>
                <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">cz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">cz</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s">&quot;&quot;</span>
                            <span class="k">print</span> <span class="s">&quot;{0:3}, {1:3}: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">),</span>
                        <span class="n">off</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">getOffset</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
                        <span class="n">sector</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">off</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">off</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
                        <span class="k">print</span> <span class="s">&quot;{sector:&gt;6}+{length:&lt;2} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()),</span>
                    <span class="k">print</span> <span class="s">&quot;&quot;</span>

                <span class="n">runs</span> <span class="o">=</span> <span class="n">getFreeSectors</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&quot;Free sectors:&quot;</span><span class="p">,</span>

                    <span class="n">printFreeSectors</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;free&quot;</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Calling allChunks to preload region files: </span><span class="si">%d</span><span class="s"> chunks&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">),</span> <span class="n">rf</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">regionFiles</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>

                        <span class="n">runs</span> <span class="o">=</span> <span class="n">getFreeSectors</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
                            <span class="k">print</span> <span class="s">&quot;R {0:3}, {1:3}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">),</span>
                            <span class="n">printFreeSectors</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Calling allChunks to preload region files: </span><span class="si">%d</span><span class="s"> chunks&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">level</span><span class="o">.</span><span class="n">regionFiles</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;({rx:6}, {rz:6}): {count}, &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">level</span><span class="o">.</span><span class="n">regionFiles</span><span class="p">[</span><span class="n">rx</span><span class="p">,</span> <span class="n">rz</span><span class="p">]</span><span class="o">.</span><span class="n">chunkCount</span><span class="p">),</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_repair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    repair</span>

<span class="sd">    Attempt to repair inconsistent region files.</span>
<span class="sd">    MAKE A BACKUP. WILL DELETE YOUR DATA.</span>

<span class="sd">    Scans for and repairs errors in region files:</span>
<span class="sd">        Deletes chunks whose sectors overlap with another chunk</span>
<span class="sd">        Rearranges chunks that are in the wrong slot in the offset table</span>
<span class="sd">        Deletes completely unreadable chunks</span>

<span class="sd">    Only usable with region-format saves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">preloadRegions</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">rf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">regionFiles</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">rf</span><span class="o">.</span><span class="n">repair</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_dumpchests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dumpChests [ &lt;filename&gt; ]</span>

<span class="sd">    Saves the content and location of every chest in the world to a text file.</span>
<span class="sd">    With no filename, saves signs to &lt;worldname&gt;.chests</span>

<span class="sd">    Output is delimited by brackets and newlines. A set of coordinates in</span>
<span class="sd">    brackets begins a chest, followed by a line for each inventory slot.</span>
<span class="sd">    For example:</span>

<span class="sd">        [222, 51, 22]</span>
<span class="sd">        2 String</span>
<span class="sd">        3 String</span>
<span class="sd">        3 Iron bar</span>

<span class="sd">    Coordinates are ordered the same as point inputs:</span>
<span class="sd">        [North/South, Down/Up, East/West]</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pymclevel.items</span> <span class="kn">import</span> <span class="n">items</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">displayName</span> <span class="o">+</span> <span class="s">&quot;.chests&quot;</span>

        <span class="n">outFile</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Dumping chests...&quot;</span>
        <span class="n">chestCount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cPos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="o">*</span><span class="n">cPos</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">mclevelbase</span><span class="o">.</span><span class="n">ChunkMalformed</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">tileEntity</span> <span class="ow">in</span> <span class="n">chunk</span><span class="o">.</span><span class="n">TileEntities</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&quot;Chest&quot;</span><span class="p">:</span>
                    <span class="n">chestCount</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">tileEntity</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;xyz&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="n">itemsTag</span> <span class="o">=</span> <span class="n">tileEntity</span><span class="p">[</span><span class="s">&quot;Items&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemsTag</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">itemTag</span> <span class="ow">in</span> <span class="n">itemsTag</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="nb">id</span> <span class="o">=</span> <span class="n">itemTag</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                                <span class="n">damage</span> <span class="o">=</span> <span class="n">itemTag</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                                <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">findItem</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">damage</span><span class="p">)</span>
                                <span class="n">itemname</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">itemname</span> <span class="o">=</span> <span class="s">&quot;Unknown Item {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itemTag</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                                <span class="n">itemname</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                            <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0} {1}:{2}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">itemTag</span><span class="p">[</span><span class="s">&quot;Count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">itemname</span><span class="p">,</span> <span class="n">itemTag</span><span class="p">[</span><span class="s">&quot;Damage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Empty Chest</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Chunk {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Dumped {0} chests to {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chestCount</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_removeentities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    removeEntities [ [except] [ &lt;EntityID&gt; [ &lt;EntityID&gt; ... ] ] ]</span>

<span class="sd">    Remove all entities matching one or more entity IDs.</span>
<span class="sd">    With the except keyword, removes all entities not</span>
<span class="sd">    matching one or more entity IDs.</span>

<span class="sd">    Without any IDs, removes all entities in the world,</span>
<span class="sd">    except for Paintings.</span>

<span class="sd">    Known Mob Entity IDs:</span>
<span class="sd">        Mob Monster Creeper Skeleton Spider Giant</span>
<span class="sd">        Zombie Slime Pig Sheep Cow Chicken</span>

<span class="sd">    Known Item Entity IDs: Item Arrow Snowball Painting</span>

<span class="sd">    Known Vehicle Entity IDs: Minecart Boat</span>

<span class="sd">    Known Dynamic Tile Entity IDs: PrimedTnt FallingSand</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">ENT_MATCHTYPE_ANY</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ENT_MATCHTYPE_EXCEPT</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ENT_MATCHTYPE_NONPAINTING</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">entityID</span><span class="p">,</span> <span class="n">matchType</span><span class="p">,</span> <span class="n">matchWords</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ENT_MATCHTYPE_ANY</span> <span class="o">==</span> <span class="n">matchType</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entityID</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">matchWords</span>
            <span class="k">elif</span> <span class="n">ENT_MATCHTYPE_EXCEPT</span> <span class="o">==</span> <span class="n">matchType</span><span class="p">:</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">entityID</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">matchWords</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># ENT_MATCHTYPE_EXCEPT == matchType</span>
                <span class="k">return</span> <span class="n">entityID</span> <span class="o">!=</span> <span class="s">&quot;Painting&quot;</span>

        <span class="n">removedEntities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">match_words</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;except&quot;</span><span class="p">:</span>
                <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;Removing all entities except &quot;</span><span class="p">,</span> <span class="n">command</span>
                <span class="n">match_type</span> <span class="o">=</span> <span class="n">ENT_MATCHTYPE_EXCEPT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Removing {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
                <span class="n">match_type</span> <span class="o">=</span> <span class="n">ENT_MATCHTYPE_ANY</span>

            <span class="n">match_words</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">command</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Removing all entities except Painting...&quot;</span>
            <span class="n">match_type</span> <span class="o">=</span> <span class="n">ENT_MATCHTYPE_NONPAINTING</span>

        <span class="k">for</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
            <span class="n">entitiesRemoved</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">Entities</span><span class="p">):</span>
                <span class="n">entityID</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

                <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">entityID</span><span class="p">,</span> <span class="n">match_type</span><span class="p">,</span> <span class="n">match_words</span><span class="p">):</span>
                    <span class="n">removedEntities</span><span class="p">[</span><span class="n">entityID</span><span class="p">]</span> <span class="o">=</span> <span class="n">removedEntities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entityID</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="n">chunk</span><span class="o">.</span><span class="n">Entities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
                    <span class="n">entitiesRemoved</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">entitiesRemoved</span><span class="p">:</span>
                <span class="n">chunk</span><span class="o">.</span><span class="n">chunkChanged</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">removedEntities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;No entities to remove.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Removed entities:&quot;</span>
            <span class="k">for</span> <span class="n">entityID</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">removedEntities</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">print</span> <span class="s">&quot;  {0}: {1:6}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entityID</span><span class="p">,</span> <span class="n">removedEntities</span><span class="p">[</span><span class="n">entityID</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_createchunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    createChunks &lt;box&gt;</span>

<span class="sd">    Creates any chunks not present in the specified region.</span>
<span class="sd">    New chunks are filled with only air. New chunks are written</span>
<span class="sd">    to disk immediately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;createchunks&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">chunksCreated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">createChunksInBox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Created {0} chunks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunksCreated</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_deletechunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    deleteChunks &lt;box&gt;</span>

<span class="sd">    Removes all chunks contained in the specified region.</span>
<span class="sd">    Chunks are deleted from disk immediately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;deletechunks&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">deletedChunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">deleteChunksInBox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Deleted {0} chunks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deletedChunks</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    prune &lt;box&gt;</span>

<span class="sd">    Removes all chunks not contained in the specified region. Useful for enforcing a finite map size.</span>
<span class="sd">    Chunks are deleted from disk immediately.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;prune&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cz</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cx</span> <span class="o">&lt;</span> <span class="n">box</span><span class="o">.</span><span class="n">mincx</span> <span class="ow">or</span> <span class="n">cx</span> <span class="o">&gt;=</span> <span class="n">box</span><span class="o">.</span><span class="n">maxcx</span> <span class="ow">or</span> <span class="n">cz</span> <span class="o">&lt;</span> <span class="n">box</span><span class="o">.</span><span class="n">mincz</span> <span class="ow">or</span> <span class="n">cz</span> <span class="o">&gt;=</span> <span class="n">box</span><span class="o">.</span><span class="n">maxcz</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">deleteChunk</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">print</span> <span class="s">&quot;Pruned {0} chunks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_relight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    relight [ &lt;box&gt; ]</span>

<span class="sd">    Recalculates lights in the region specified. If omitted,</span>
<span class="sd">    recalculates the entire world.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBox</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">mincx</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">maxcx</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">mincz</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">maxcz</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">allChunks</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">generateLights</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Relit 0 chunks.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create [ &lt;filename&gt; ]</span>

<span class="sd">    Create and load a new Minecraft Alpha world. This world will have no</span>
<span class="sd">    chunks and a random terrain seed. If run from the shell, filename is not</span>
<span class="sd">    needed because you already specified a filename earlier in the command.</span>
<span class="sd">    For example:</span>

<span class="sd">        mce.py MyWorld create</span>

<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Expected a filename&quot;</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;{0} already exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">MCInfdevOldLevel</span><span class="o">.</span><span class="n">isLevel</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;{0} is already a Minecraft Alpha world&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="n">level</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">MCInfdevOldLevel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="nf">_degrief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    degrief [ &lt;height&gt; ]</span>

<span class="sd">    Reverse a few forms of griefing by removing</span>
<span class="sd">    Adminium, Obsidian, Fire, and Lava wherever</span>
<span class="sd">    they occur above the specified height.</span>
<span class="sd">    Without a height, uses height level 32.</span>

<span class="sd">    Removes natural surface lava.</span>

<span class="sd">    Also see removeEntities</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">BoundingBox</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">origin</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">box</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">box</span><span class="o">.</span><span class="n">miny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">print</span> <span class="s">&quot;Removing grief matter and surface lava above height {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">miny</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">fillBlocks</span><span class="p">(</span><span class="n">box</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">Air</span><span class="p">,</span>
                              <span class="n">blocksToReplace</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">Bedrock</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">Obsidian</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">Fire</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">LavaActive</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">Lava</span><span class="p">,</span>
                              <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    time [time of day]</span>

<span class="sd">    Set or display the time of day. Acceptable values are &quot;morning&quot;, &quot;noon&quot;,</span>
<span class="sd">    &quot;evening&quot;, &quot;midnight&quot;, or a time of day such as 8:02, 12:30 PM, or 16:45.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">Time</span>
        <span class="n">timeOfDay</span> <span class="o">=</span> <span class="n">ticks</span> <span class="o">%</span> <span class="mi">24000</span>
        <span class="n">ageInTicks</span> <span class="o">=</span> <span class="n">ticks</span> <span class="o">-</span> <span class="n">timeOfDay</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">days</span> <span class="o">=</span> <span class="n">ageInTicks</span> <span class="o">/</span> <span class="mi">24000</span>
            <span class="n">hours</span> <span class="o">=</span> <span class="n">timeOfDay</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="n">clockHours</span> <span class="o">=</span> <span class="p">(</span><span class="n">hours</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">24</span>

            <span class="n">ampm</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;AM&quot;</span><span class="p">,</span> <span class="s">&quot;PM&quot;</span><span class="p">)[</span><span class="n">clockHours</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">]</span>

            <span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">timeOfDay</span> <span class="o">%</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>

            <span class="k">print</span> <span class="s">&quot;It is {0}:{1:02} {2} on Day {3}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clockHours</span> <span class="o">%</span> <span class="mi">12</span> <span class="ow">or</span> <span class="mi">12</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">ampm</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;morning&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&quot;noon&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s">&quot;evening&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&quot;midnight&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">}</span>
            <span class="n">word</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">minutes</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
                <span class="n">hours</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span>
                        <span class="n">h</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UsageError</span><span class="p">((</span><span class="s">&quot;Cannot interpret time, &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;pm&quot;</span><span class="p">:</span>
                        <span class="n">hours</span> <span class="o">+=</span> <span class="mi">12</span>

            <span class="n">ticks</span> <span class="o">=</span> <span class="n">ageInTicks</span> <span class="o">+</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">-</span> <span class="mi">6000</span>
            <span class="k">if</span> <span class="n">ticks</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ticks</span> <span class="o">+=</span> <span class="mi">18000</span>

            <span class="n">ampm</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;AM&quot;</span><span class="p">,</span> <span class="s">&quot;PM&quot;</span><span class="p">)[</span><span class="mi">11</span> <span class="o">&lt;</span> <span class="n">hours</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;Changed time to {0}:{1:02} {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hours</span> <span class="o">%</span> <span class="mi">12</span> <span class="ow">or</span> <span class="mi">12</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">ampm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">Time</span> <span class="o">=</span> <span class="n">ticks</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_randomseed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    randomseed [ &lt;seed&gt; ]</span>

<span class="sd">    Set or display the world&#39;s random seed, a 64-bit integer that uniquely</span>
<span class="sd">    defines the world&#39;s terrain.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">seed</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Expected a long integer.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">RandomSeed</span> <span class="o">=</span> <span class="n">seed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Random Seed: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">RandomSeed</span>

    <span class="k">def</span> <span class="nf">_gametype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gametype [ &lt;player&gt; [ &lt;gametype&gt; ] ]</span>

<span class="sd">    Set or display the player&#39;s game type, an integer that identifies whether</span>
<span class="sd">    their game is survival (0) or creative (1).  On single-player worlds, the</span>
<span class="sd">    player is just &#39;Player&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Players: &quot;</span>
            <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">players</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;    {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerGameType</span><span class="p">(</span><span class="n">player</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">player</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Player {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getPlayerGameType</span><span class="p">(</span><span class="n">player</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">gametype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Expected an integer.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">setPlayerGameType</span><span class="p">(</span><span class="n">gametype</span><span class="p">,</span> <span class="n">player</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_worldsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    worldsize</span>

<span class="sd">    Computes and prints the dimensions of the world.  For infinite worlds,</span>
<span class="sd">    also prints the most negative corner.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">MCInfdevOldLevel</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">World size: </span><span class="se">\n</span><span class="s">  {0[0]:7} north to south</span><span class="se">\n</span><span class="s">  {0[2]:7} east to west</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;Smallest and largest points: ({0[0]},{0[2]}), ({1[0]},{1[2]})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">bounds</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">World size: </span><span class="se">\n</span><span class="s">  {0[0]:7} wide</span><span class="se">\n</span><span class="s">  {0[1]:7} tall</span><span class="se">\n</span><span class="s">  {0[2]:7} long</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bounds</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_heightmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    heightmap &lt;filename&gt;</span>

<span class="sd">    Takes a png and imports it as the terrain starting at chunk 0,0.</span>
<span class="sd">    Data is internally converted to greyscale and scaled to the maximum height.</span>
<span class="sd">    The game will fill the terrain with trees and mineral deposits the next</span>
<span class="sd">    time you play the level.</span>

<span class="sd">    Please please please try out a small test image before using a big source.</span>
<span class="sd">    Using the levels tool to get a good heightmap is an art, not a science.</span>
<span class="sd">    A smaller map lets you experiment and get it right before having to blow</span>
<span class="sd">    all night generating the really big map.</span>

<span class="sd">    Requires the PIL library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;heightmap&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">raw_input</span><span class="p">(</span>
                <span class="s">&quot;This will destroy a large portion of the map and may take a long time.  Did you really want to do this?&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;yes&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">):</span>

            <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
            <span class="kn">import</span> <span class="nn">datetime</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">imgobj</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="n">greyimg</span> <span class="o">=</span> <span class="n">imgobj</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">)</span>  <span class="c"># luminance</span>
            <span class="k">del</span> <span class="n">imgobj</span>

            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">greyimg</span><span class="o">.</span><span class="n">size</span>

            <span class="n">water_level</span> <span class="o">=</span> <span class="mi">64</span>

            <span class="n">xchunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span>
            <span class="n">zchunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">15</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span>

            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xchunks</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cz</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zchunks</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">createChunk</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">getChunk</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">)</span>

                    <span class="n">imgarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">greyimg</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">cz</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="n">cx</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="n">cz</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">cx</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)))</span>
                    <span class="n">imgarray</span> <span class="o">/=</span> <span class="mi">2</span>  <span class="c"># scale to 0-127</span>

                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="n">cz</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">cx</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="c"># world dimension X goes north-south</span>
                                <span class="c"># first array axis goes up-down</span>

                                <span class="n">h</span> <span class="o">=</span> <span class="n">imgarray</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>

                                <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># air</span>
                                <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span><span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># grass</span>
                                <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">4</span><span class="p">:</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># dirt</span>
                                <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">:</span><span class="n">h</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># rock</span>

                                <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">water_level</span><span class="p">:</span>
                                    <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">water_level</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>  <span class="c"># water</span>
                                <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">water_level</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span><span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c"># sand if it&#39;s near water level</span>

                                <span class="n">c</span><span class="o">.</span><span class="n">Blocks</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c"># bedrock</span>

                    <span class="n">c</span><span class="o">.</span><span class="n">chunkChanged</span><span class="p">()</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">TerrainPopulated</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="c"># the quick lighting from chunkChanged has already lit this simple terrain completely</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">needsLighting</span> <span class="o">=</span> <span class="bp">False</span>

                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> Just did chunk </span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;[%H:%M:%S]&quot;</span><span class="p">),</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cz</span><span class="p">))</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Done with mapping!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Took </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

            <span class="n">spawnz</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">spawnx</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">spawny</span> <span class="o">=</span> <span class="n">greyimg</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">spawnx</span><span class="p">,</span> <span class="n">spawnz</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;You probably want to change your spawn point. I suggest {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">spawnx</span><span class="p">,</span> <span class="n">spawny</span><span class="p">,</span> <span class="n">spawnz</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    execute &lt;filename&gt;</span>
<span class="sd">    Execute all commands in a file and save.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;You must give the file with commands to execute&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">commandFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">commandsFromFile</span> <span class="o">=</span> <span class="n">commandFile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">commandFromFile</span> <span class="ow">in</span> <span class="n">commandsFromFile</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">commandFromFile</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processCommand</span><span class="p">(</span><span class="n">commandFromFile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_quit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    quit [ yes | no ]</span>

<span class="sd">    Quits the program.</span>
<span class="sd">    Without &#39;yes&#39; or &#39;no&#39;, prompts to save before quitting.</span>

<span class="sd">    In batch mode, an end of file automatically saves the level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;yes&quot;</span><span class="p">,</span> <span class="s">&quot;no&quot;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Save before exit? &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;yes&quot;</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;true&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="ow">and</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span> <span class="o">==</span> <span class="s">&quot;yes&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">SystemExit</span>

    <span class="k">def</span> <span class="nf">_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quit</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">generateLights</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">saveInPlace</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">needsSave</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    load [ &lt;filename&gt; | &lt;world number&gt; ]</span>

<span class="sd">    Loads another world, discarding all changes to this world.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="s">&quot;load&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadWorld</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    dimension [ &lt;dim&gt; ]</span>

<span class="sd">    Load another dimension, a sub-world of this level. Without options, lists</span>
<span class="sd">    all of the dimensions found in this world. &lt;dim&gt; can be a number or one of</span>
<span class="sd">    these keywords:</span>
<span class="sd">        nether, hell, slip: DIM-1</span>
<span class="sd">        earth, overworld, parent: parent world</span>
<span class="sd">        end: DIM1</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;earth&quot;</span><span class="p">,</span> <span class="s">&quot;overworld&quot;</span><span class="p">,</span> <span class="s">&quot;parent&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">parentWorld</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">parentWorld</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;You are already on earth.&quot;</span>
                    <span class="k">return</span>

            <span class="k">elif</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;hell&quot;</span><span class="p">,</span> <span class="s">&quot;nether&quot;</span><span class="p">,</span> <span class="s">&quot;slip&quot;</span><span class="p">):</span>
                <span class="n">dimNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;end&quot;</span><span class="p">:</span>
                <span class="n">dimNo</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dimNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readInt</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dimNo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="n">dimNo</span><span class="p">]</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">parentWorld</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">u&quot;Parent world: {0} (&#39;dimension parent&#39; to return)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">parentWorld</span><span class="o">.</span><span class="n">displayName</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimensions</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">u&quot;Dimensions in {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">displayName</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;{0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">infiniteworld</span><span class="o">.</span><span class="n">MCAlphaDimension</span><span class="o">.</span><span class="n">dimensionNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&quot;Unknown&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    blocks [ &lt;block name&gt; | &lt;block ID&gt; ]</span>

<span class="sd">    Prints block IDs matching the name, or the name matching the ID.</span>
<span class="sd">    With nothing, prints a list of all blocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
            <span class="n">searchName</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">searchNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">searchName</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">blocksMatching</span><span class="p">(</span><span class="n">searchName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">allBlocks</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="n">searchNumber</span><span class="p">]</span>
            <span class="c">#                print &quot;{0:3}: {1}&quot;.format(searchNumber, self.level.materials.names[searchNumber])</span>
            <span class="c">#               return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">allBlocks</span>

        <span class="k">print</span> <span class="s">&quot;{id:9} : {name} {aka}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s">&quot;(ID:data)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Block name&quot;</span><span class="p">,</span> <span class="n">aka</span><span class="o">=</span><span class="s">&quot;[Other names]&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
            <span class="n">idstring</span> <span class="o">=</span> <span class="s">&quot;({ID}:{data})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ID</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">blockData</span><span class="p">)</span>
            <span class="n">aka</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">aka</span> <span class="ow">and</span> <span class="s">&quot; [{aka}]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aka</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">aka</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>

            <span class="k">print</span> <span class="s">&quot;{idstring:9} : {name} {aka}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idstring</span><span class="o">=</span><span class="n">idstring</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">aka</span><span class="o">=</span><span class="n">aka</span><span class="p">)</span>

<div class="viewcode-block" id="mce.printUsage"><a class="viewcode-back" href="../mce.html#mce.mce.printUsage">[docs]</a>    <span class="k">def</span> <span class="nf">printUsage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Usage: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commandUsage</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandPrefix</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;mce.py &lt;world&gt; &quot;</span><span class="p">)[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">batchMode</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="mce.printUsageAndQuit"><a class="viewcode-back" href="../mce.html#mce.mce.printUsageAndQuit">[docs]</a>    <span class="k">def</span> <span class="nf">printUsageAndQuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span>
</div>
<div class="viewcode-block" id="mce.loadWorld"><a class="viewcode-back" href="../mce.html#mce.mce.loadWorld">[docs]</a>    <span class="k">def</span> <span class="nf">loadWorld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">):</span>

        <span class="n">worldpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">worldpath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">worldpath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">mclevel</span><span class="o">.</span><span class="n">loadWorld</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
</div>
    <span class="n">level</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">batchMode</span> <span class="o">=</span> <span class="bp">False</span>

<div class="viewcode-block" id="mce.run"><a class="viewcode-back" href="../mce.html#mce.mce.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">u&#39;</span><span class="si">%(levelname)s</span><span class="s">:</span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>

        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
            <span class="n">world</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">world</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;-h&quot;</span><span class="p">,</span> <span class="s">&quot;--help&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printUsageAndQuit</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;create&quot;</span><span class="p">:</span>
                <span class="c"># accept the syntax, &quot;mce world3 create&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create</span><span class="p">([</span><span class="n">world</span><span class="p">])</span>
                <span class="k">print</span> <span class="s">&quot;Created world {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>

                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadWorld</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batchMode</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">()</span>

            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">world</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Please enter world name or path to world folder: &quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadWorld</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;End of input.&quot;</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Cannot open {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">world</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
            <span class="c"># process one command from command line</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">processCommand</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">UsageError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printUsageAndQuit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">([])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># process many commands on standard input, maybe interactively</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batchMode</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">u&quot;{0}&gt; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">displayName</span><span class="p">))</span>
                    <span class="k">print</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processCommand</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;End of file. Saving automatically.&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">([])</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                    <span class="k">print</span> <span class="s">&#39;Exception during command: {0!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&quot;Use &#39;debug&#39; to enable tracebacks.&quot;</span>

                    <span class="c"># self.printUsage()</span>
</div>
<div class="viewcode-block" id="mce.processCommand"><a class="viewcode-back" href="../mce.html#mce.mce.processCommand">[docs]</a>    <span class="k">def</span> <span class="nf">processCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;#&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">commandWords</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">keyword</span> <span class="o">=</span> <span class="n">commandWords</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">keyword</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">keyword</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">keyword</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;Ambiguous command. Matches: &quot;</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="n">k</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s">&quot;Command {0} not recognized.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span>

        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">keyword</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">commandWords</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">PlayerNotFound</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Cannot find player {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_player</span><span class="p">([])</span>

        <span class="k">except</span> <span class="n">UsageError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printUsage</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../mce.html#mce.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;MCE_PROFILE&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">editor</span> <span class="o">=</span> <span class="n">mce</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">profile</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Profiling enabled&quot;</span>
        <span class="kn">import</span> <span class="nn">cProfile</span>

        <span class="n">cProfile</span><span class="o">.</span><span class="n">runctx</span><span class="p">(</span><span class="s">&#39;editor.run()&#39;</span><span class="p">,</span> <span class="nb">locals</span><span class="p">(),</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">profile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">editor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">return</span> <span class="mi">0</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../index.html">MCEdit-Unified v1.5.6.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../genindex.html" title="General Index" >index</a></li>
        <li><a href="index.html" >Module code</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2010-2014 David Rio Vierra (Codewarrior0). 2014-2016 MCEdit-Unified Team and all of the contributers. All Rights Reserved to their respective ownership..
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>